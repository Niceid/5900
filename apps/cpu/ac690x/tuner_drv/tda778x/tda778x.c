#include "tda778x/tda778x.h"
#include "rds/rds_dec.h"

#include "setup.h"

#if defined(_TUNER_DRIVER_TDA778x_)

static tda778x_ctrl_t *tda778x_ctrl = NULL;
static const uint16 fm_tda778x_deal_spot_tab[] = {9600};
static const uint16 am_tda778x_deal_spot_tab[] = {};
extern volatile u32 g_rand_seed;

/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/

static void delay_1us(uint8 count)
{
	uint8 i,j;
	for(i = 0;i < count; i++)
	{
		for(j = 0; j < 10; j++)
		{
			asm volatile ("nop");
		}
	}
}


static uint8 Write_TDA778x_RegMap(const uint8 *value, uint16 length)
{
	if(!length)return TRUE;
	i2c_data_init(TDA778x_I2C_ADDR, TDA778x_I2C_RATE, &radio_gpio);
	uint8 result = i2c_data_w(value, length);
	i2c_data_exit();
	return result;
}

static uint8 Read_TDA778x_RegMap(uint8 *value, uint16 length)
{
	if(!length)return TRUE;

	i2c_data_init(TDA778x_I2C_ADDR, TDA778x_I2C_RATE, &radio_gpio);
	uint8 result = i2c_data_r(value, length);
	i2c_data_exit();
	return result;
}

static uint8 check_detect_tda778x(void)
{
	i2c_data_init(TDA778x_I2C_ADDR, TDA778x_I2C_RATE, &radio_gpio);
	uint8 result = i2c_data_w(NULL, 0);
	i2c_data_exit();

	return result;
}

static uint8 tda778x_i2c_download(const uint8* value)
{
	while((*value) != 0xFF)
	{
		uint8 length = (*value++) * 4;
		uint8 buffer[3 + length];

		buffer[0] = ((*value++) & 0x01)|0xE0;
		buffer[1] = (*value++);
		buffer[2] = (*value++);
		memcpy(&buffer[3], value, length);
		value += length;

		if(!i2c_data_w(buffer, 3 + length))return FALSE;
	}

	return TRUE;
}

static uint8 Write_TDA778x_Download(const uint8 *value)
{
	i2c_data_init(TDA778x_I2C_ADDR, TDA778x_I2C_RATE, &radio_gpio);
	uint8 result = tda778x_i2c_download(value);
	i2c_data_exit();

	return result;
}
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
static uint8 tda778x_direct_write(tda778x_com_e com_type, uint8 check)
{
	switch(com_type)
	{
		case TDA778x_COM_1:
			{
				uint8 buffer[3 + 4];
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0x80;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];
				buffer[length++] = tda778x_order.buffer[0];
				buffer[length++] = tda778x_order.buffer[1];
				buffer[length++] = tda778x_order.buffer[2];
				buffer[length++] = tda778x_order.buffer[3];

				return Write_TDA778x_RegMap(buffer, length);
			}
			break;

		case TDA778x_COM_2:
			{
				uint8 buffer[3 + 3];
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0x90;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];
				buffer[length++] = tda778x_order.buffer[0];
				buffer[length++] = tda778x_order.buffer[1];
				buffer[length++] = tda778x_order.buffer[2];

				return Write_TDA778x_RegMap(buffer, length);
			}
			break;

		case TDA778x_COM_3:
			{
				uint8 buffer[40];
				uint16 checksum[4] = {0, 0, 0, 0};
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0xE0;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];

				uint16 index;
				for(index = 0; index < tda778x_order.length; index++)
				{
					buffer[length++] = tda778x_order.buffer[index * 4 + 0];
					buffer[length++] = tda778x_order.buffer[index * 4 + 1];
					buffer[length++] = tda778x_order.buffer[index * 4 + 2];
					buffer[length++] = tda778x_order.buffer[index * 4 + 3];

					if(check)
					{
						uint8 j;
						for(j = 3; j >= 1;j--)
						{
						 	checksum[j] += tda778x_order.buffer[index * 4 + j];
							if(checksum[j] >= 256)
							{
								checksum[j - 1] ++;
								checksum[j] -= 256;
							}
						}
						checksum[0] += tda778x_order.buffer[index * 4];
						if(checksum[0] >= 256)
						{
							checksum[0] -= 256;
						}
					}
				}

				if(check)
				{
					buffer[length++] = _u16to8l_(checksum[0]);
					buffer[length++] = _u16to8l_(checksum[1]);
					buffer[length++] = _u16to8l_(checksum[2]);
					buffer[length++] = _u16to8l_(checksum[3]);
				}

				return Write_TDA778x_RegMap(buffer, length);
			}
			break;

		case TDA778x_COM_4:
			{
				uint8 buffer[40];
				uint16 checksum[3] = {0, 0, 0};
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0xF0;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];

				uint16 index;
				for(index = 0; index < tda778x_order.length; index++)
				{
					buffer[length++] = tda778x_order.buffer[index * 3 + 0];
					buffer[length++] = tda778x_order.buffer[index * 3 + 1];
					buffer[length++] = tda778x_order.buffer[index * 3 + 2];

					if(check)
					{
						uint8 j;
						for(j = 2; j >= 1;j--)
						{
						 	checksum[j] += tda778x_order.buffer[index * 3 + j];
							if(checksum[j] >= 256)
							{
								checksum[j - 1] ++;
								checksum[j] -= 256;
							}
						}
						checksum[0] += tda778x_order.buffer[index * 3];
						if(checksum[0] >= 256)
						{
							checksum[0] -= 256;
						}
					}
				}

				if(check)
				{
					buffer[length++] = _u16to8l_(checksum[0]);
					buffer[length++] = _u16to8l_(checksum[1]);
					buffer[length++] = _u16to8l_(checksum[2]);
				}
				return Write_TDA778x_RegMap(buffer, length);
			}
			break;

		default:
			break;
	}
	return FALSE;
}

static uint8 tda778x_direct_read(tda778x_com_e com_type)
{
	switch(com_type)
	{
		case TDA778x_COM_1:
			{
				uint8 buffer[3];
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0x00;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];

				if(Write_TDA778x_RegMap(buffer, length))
				{
					delay_1us(50);
					return Read_TDA778x_RegMap(tda778x_order.buffer, 4);
				}
			}
			break;

		case TDA778x_COM_2:
			{
				uint8 buffer[3];
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0x10;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];

				if(Write_TDA778x_RegMap(buffer, length))
				{
					delay_1us(50);
					return Read_TDA778x_RegMap(tda778x_order.buffer, 3);
				}
			}
			break;

		case TDA778x_COM_3:
			{
				uint8 buffer[3];
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0x60;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];

				if(Write_TDA778x_RegMap(buffer, length))
				{
					delay_1us(50);
					return Read_TDA778x_RegMap(tda778x_order.buffer, tda778x_order.length * 4);
				}
			}
			break;

		case TDA778x_COM_4:
			{
				uint8 buffer[3];
				uint16 length = 0;

				buffer[length++] = (tda778x_order.addr[0] & 0x01)|0x70;
				buffer[length++] = tda778x_order.addr[1];
				buffer[length++] = tda778x_order.addr[2];

				if(Write_TDA778x_RegMap(buffer, length))
				{
					delay_1us(50);
					return Read_TDA778x_RegMap(tda778x_order.buffer, tda778x_order.length * 3);
				}
			}
			break;

		default:
			break;
	}

	return FALSE;
}

static uint8 tda778x_cmd_write_read(uint8 cmd, uint8 write_length, uint8 read_length)
{
	uint8 check_1, check_2;

	tda778x_order.length 	= write_length + 1;
	tda778x_order.addr[0] 	= 0x01;
	tda778x_order.addr[1] 	= 0x90;
	tda778x_order.addr[2] 	= 0x00;

	check_1 = tda778x_order.buffer[0] = (cmd & 0xF0) >> 4;
	check_2 = tda778x_order.buffer[1] = (cmd & 0x0F) << 4;
	tda778x_order.buffer[2] = tda778x_order.length & 0x1F;

	tda778x_direct_write(TDA778x_COM_4, TRUE);
	if(read_length)
	{
		tda778x_order.length 	= read_length;
		tda778x_order.addr[0] 	= 0x01;
		tda778x_order.addr[1] 	= 0x90;
		tda778x_order.addr[2] 	= 0xEB;

		if(!tda778x_direct_read(TDA778x_COM_4))return FALSE;

		if(tda778x_ctrl->cmd_check)
		{
			if((tda778x_order.buffer[0] != check_1) || (tda778x_order.buffer[1] != check_2))return FALSE;
		}
	}
	return TRUE;
}

/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
static const uint8 TDA778x_I2CBootData[]=
{
	1 ,0x01,0xAB,0x00,0x00,0x00,0x01,0x00,
	16 ,0x01,0xC0,0x00,0xFB,0x80,0x10,0x00,0xFB,0xD0,0x12,0x00,0xFB,0xD0,0x32,0x00,0xFB,0xD0,0x9A,0x00,0xFF,0xF7,0x00,0x00,0xFF,0xF7,0x00,0x00,0xFF,0xF7,0x00,0x00,0xFF,0xF7,0x00,0x00,0xE1,0xFF,0xE0,0x1B,0x90,0x00,0x70,0x53,0x92,0x00,0x50,0x6B,0x92,0x00,0x90,0x1F,0xFB,0x27,0x00,0x00,0xFF,0xE6,0x02,0x98,0xFB,0x80,0x22,0x00,0x00,0x00,0x00,0x00,
	32 ,0x01,0xC0,0x11,0xE0,0xFF,0xE0,0x00,0xE4,0x00,0x00,0x00,0xC0,0xA0,0x00,0x20,0xFB,0x27,0x02,0x43,0x4C,0x62,0x40,0x00,0xFF,0xF7,0x00,0x00,0xD8,0x00,0x00,0x20,0xFB,0x10,0x22,0x43,0x4C,0x62,0x00,0x00,0xFB,0xD1,0x9E,0x40,0xFB,0x10,0x20,0x00,0xFB,0x81,0x48,0x40,0xC0,0x0D,0x40,0x20,0x90,0x8A,0xE0,0x00,0xC0,0x80,0x00,0x20,0xFC,0x04,0x02,0x43,0x4C,0x67,0x00,0x00,0x94,0x01,0x40,0x00,0xC0,0x00,0x20,0x20,0x94,0xB0,0x40,0x1B,0x90,0x01,0xC0,0x00,0xA8,0x00,0x40,0x00,0x81,0x1D,0x60,0x00,0xA0,0x01,0xC0,0x1B,0xFC,0x04,0x00,0x65,0xFB,0x80,0x5C,0x06,0xFB,0x80,0x52,0x01,0xFF,0xF7,0x00,0x00,0xA0,0x01,0xC0,0x6B,0x90,0xA1,0x20,0x1B,0x90,0x01,0xC0,0x00,0xFB,0x10,0x20,0x00,
	32 ,0x01,0xC0,0x31,0xFB,0xE0,0xBE,0x40,0xAC,0xFF,0x80,0x00,0xFC,0x04,0x00,0x61,0xFB,0x80,0x84,0x06,0xA4,0x90,0xE0,0x00,0xA0,0x01,0x00,0x00,0xE1,0x09,0x80,0x00,0x4F,0xA7,0x00,0x00,0xA0,0x01,0x80,0x00,0x40,0xA7,0x04,0x05,0xA0,0x01,0xA0,0x33,0xAC,0x9E,0xD4,0x05,0x40,0xA7,0x19,0x37,0xFC,0x04,0x09,0xA4,0xFB,0x80,0x9C,0x01,0x44,0xA7,0x10,0x24,0x64,0xA7,0x00,0x00,0xE1,0x09,0xC0,0x00,0xA0,0x01,0x00,0x00,0x4F,0xA7,0x00,0x00,0xA0,0x01,0x80,0x00,0xA4,0x90,0xE0,0x00,0xA0,0x01,0xA4,0x05,0xFC,0x04,0x00,0x33,0xAC,0x9E,0xD4,0x05,0xFC,0x04,0x19,0x37,0xFC,0x04,0x09,0xA4,0x44,0xA7,0x10,0x24,0x64,0xA7,0x00,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD5,0x5C,0x40,0xFB,0x10,0x20,0x00,
	32 ,0x01,0xC0,0x51,0xFB,0xD3,0x04,0x40,0xFB,0x10,0x20,0x00,0xFB,0xCE,0x90,0x40,0xFB,0x10,0x20,0x00,0xFB,0xCB,0x72,0x40,0xA0,0x02,0x20,0x00,0xFB,0x10,0x20,0x25,0xC0,0x0B,0x70,0x20,0xFA,0x48,0x00,0x00,0xFB,0x80,0x01,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD0,0xEE,0x40,0xFB,0x10,0x20,0x00,0xFB,0xF9,0x20,0x40,0xFB,0x10,0x20,0x00,0xFB,0xF7,0xF4,0x40,0xFB,0x10,0x20,0x00,0xFB,0xFB,0xE4,0x40,0xFB,0x10,0x20,0x00,0xFB,0xD1,0x86,0x40,0xFB,0x10,0x20,0x00,0xFB,0xD1,0x6E,0x40,0xA2,0x8A,0xE0,0x00,0xFC,0x04,0x00,0x26,0xFB,0x80,0x01,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD9,0x14,0x40,0xFB,0x81,0x20,0x01,0xC0,0x0D,0xE0,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD4,0xF4,0x40,
	32 ,0x01,0xC0,0x71,0xFB,0x81,0x20,0x01,0xC0,0x0E,0x80,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD5,0x04,0x40,0xFB,0x81,0x20,0x01,0xC0,0x0F,0x20,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD5,0x10,0x40,0xFB,0x81,0x20,0x01,0xC0,0x0F,0xC0,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x81,0x20,0x01,0xC0,0x10,0x20,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD5,0x20,0x40,0xFB,0x81,0x20,0x01,0xC0,0x10,0xC0,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD5,0x26,0x40,0xFB,0x81,0x20,0x01,0xC0,0x11,0x60,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x10,0x20,0x00,0xFB,0xD5,0x32,0x40,0xFB,0x81,0x20,0x01,0xC0,0x0D,0x40,0x20,0x90,0x8A,0xE0,0x00,0xFB,0x80,0x50,0x00,
	32 ,0x01,0xC0,0x91,0xFF,0x27,0x00,0x00,0xFF,0xF7,0x00,0x00,0xFF,0xF7,0x00,0x00,0xC1,0xD8,0x20,0x20,0x90,0x03,0x60,0x00,0xA0,0x02,0x40,0x00,0xFB,0x10,0x20,0x25,0xC0,0x13,0x70,0x20,0xFA,0x48,0x00,0x00,0xFB,0x80,0x01,0x00,0xFB,0x80,0x00,0x80,0xC1,0xD8,0x40,0x20,0x90,0x03,0x60,0x00,0xA0,0x02,0x40,0x00,0xFB,0x10,0x20,0x25,0xC0,0x14,0x70,0x20,0xFA,0x48,0x00,0x00,0xFB,0x80,0x01,0x00,0xFB,0x80,0x00,0x80,0xFB,0x10,0x20,0x00,0xFB,0x81,0x56,0x40,0xC1,0xD8,0x60,0x20,0x90,0x03,0x60,0x00,0xFB,0x10,0x20,0x00,0xFB,0xCF,0x40,0x40,0xFB,0x80,0x00,0x80,0xC0,0x13,0x80,0x20,0x94,0x01,0x80,0x00,0xC0,0x12,0x80,0x20,0x94,0x01,0xC0,0x00,0xFB,0x80,0x00,0x81,0xC0,0x16,0x40,0x20,
	10 ,0x01,0xC0,0xB1,0x94,0x02,0x40,0x00,0xC1,0xD8,0x00,0x20,0x90,0x03,0x60,0x00,0xA0,0x02,0x40,0x00,0xFB,0x10,0x20,0x25,0xC0,0x17,0x30,0x20,0xFA,0x48,0x00,0x00,0xFB,0x80,0x01,0x00,0xFB,0x80,0x00,0x80,0x00,0x00,0x00,0x00,
	10 ,0x01,0xCE,0xBA,0xFC,0x00,0x00,0x00,0x00,0x81,0x07,0x00,0xFC,0x00,0x00,0x00,0x00,0x81,0x07,0x00,0xFC,0x00,0x00,0x00,0x00,0x81,0x07,0x00,0x00,0x01,0x0E,0xBB,0x00,0x01,0x0E,0xBD,0x00,0x01,0x0E,0xBF,0x00,0x00,0x00,0x00,
	32 ,0x01,0xCF,0x90,0x91,0x80,0x00,0x00,0x90,0x00,0x47,0x4A,0x8F,0x20,0x00,0x1F,0x8E,0x01,0xA5,0x7C,0x8D,0x20,0x00,0x1F,0x8C,0x01,0xA0,0x04,0x8B,0x20,0x00,0x1F,0x8A,0x01,0x9E,0x10,0x89,0x20,0x00,0x1F,0x88,0x01,0x9D,0xAC,0x87,0x20,0x00,0x1C,0x86,0x01,0x9B,0x54,0x85,0x20,0x00,0x1C,0x84,0x01,0x98,0xFC,0x83,0x20,0x00,0x1C,0x82,0x01,0x98,0x98,0x81,0x40,0x00,0x00,0x80,0x01,0x82,0xB8,0x7F,0x80,0x00,0x00,0x7E,0x01,0x7C,0x14,0x7D,0x40,0x00,0x00,0x7C,0x01,0x72,0x82,0x7B,0x20,0x00,0x1F,0x7A,0x01,0x6B,0x48,0x79,0x20,0x00,0x1F,0x78,0x01,0x6A,0xE4,0x77,0x20,0x00,0x1F,0x76,0x01,0x38,0x80,0x75,0x20,0x00,0x1F,0x74,0x01,0x38,0x1C,0x73,0x80,0x00,0x00,0x72,0x01,0x31,0x78,
	2 ,0x01,0xCF,0xB0,0x10,0x00,0x03,0x00,0x00,0x01,0x0F,0xB0,
	1 ,0x01,0x90,0x0A,0x00,0x00,0x00,0x00,
	1 ,0x01,0x90,0xFF,0x00,0x00,0x00,0x00,
	1 ,0x01,0xB7,0xFF,0x00,0x00,0x00,0x00,
	2 ,0x01,0x40,0x04,0x00,0x50,0x00,0x10,0x01,0x80,0x10,0x82,
	1 ,0x01,0x40,0x03,0x00,0x00,0x00,0x00,
	3 ,0x01,0x40,0x07,0x00,0x01,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x0B,
	2 ,0x01,0x40,0x01,0xB7,0xC2,0x7F,0x7E,0xBE,0xC2,0x7F,0xFE,
	1 ,0x00,0xB0,0x00,0x00,0x00,0x01,0x11,
	4 ,0x00,0xA0,0x00,0x00,0x00,0x00,0x31,0x00,0x16,0xCE,0x99,0x00,0x00,0xFF,0xFF,0x00,0x05,0x9C,0xC0,
	1 ,0x00,0xB0,0x00,0x00,0x00,0x21,0x11,
	1 ,0x00,0x80,0x00,0x00,0x00,0x07,0x21,
	1 ,0x00,0x81,0x00,0x11,0x11,0x11,0x00,
	1 ,0x00,0x90,0x00,0x00,0x00,0x07,0x21,
	1 ,0x01,0x50,0x00,0x00,0x0F,0x21,0x31,
	1 ,0x01,0x40,0x01,0x80,0x02,0x7B,0x7E,
	1 ,0x01,0x10,0x00,0x00,0x00,0x05,0x01,
	1 ,0x00,0x10,0x00,0x00,0x00,0x00,0x00,
	1 ,0x00,0xE0,0x00,0x00,0x00,0x00,0x00,
	1 ,0x00,0xF0,0x00,0x00,0x00,0x00,0x09,
	32 ,0x00,0x18,0x00,0x00,0x19,0x00,0x14,0x20,0x0F,0x00,0x09,0x00,0x19,0x00,0x15,0x22,0x0F,0x00,0x09,0x00,0x19,0x00,0x16,0x24,0x0F,0x00,0x09,0x00,0x19,0x00,0x17,0x26,0x0F,0x00,0x09,0x00,0x19,0x00,0x18,0x28,0x0F,0x00,0x09,0x00,0x19,0x00,0x74,0x30,0x0F,0x00,0x09,0x00,0x19,0x00,0x75,0x32,0x0F,0x00,0x09,0x00,0x19,0x00,0x76,0x34,0x0F,0x00,0x09,0x00,0x19,0x00,0x77,0x36,0x0F,0x00,0x09,0x00,0x19,0x00,0x78,0x38,0x0F,0x00,0x09,0x00,0x19,0x00,0x1E,0x20,0x0F,0x00,0x0A,0x00,0x19,0x00,0x1F,0x22,0x0F,0x00,0x0A,0x00,0x19,0x00,0x20,0x24,0x0F,0x00,0x0A,0x00,0x19,0x00,0x21,0x26,0x0F,0x00,0x0A,0x00,0x19,0x00,0x22,0x28,0x0F,0x00,0x0A,0x00,0x19,0x00,0x7E,0x30,0x0F,0x00,0x0A,
	32 ,0x00,0x18,0x20,0x00,0x19,0x00,0x7F,0x32,0x0F,0x00,0x0A,0x00,0x19,0x00,0x80,0x34,0x0F,0x00,0x0A,0x00,0x19,0x00,0x81,0x36,0x0F,0x00,0x0A,0x00,0x19,0x00,0x82,0x38,0x0F,0x00,0x0A,0x00,0x19,0x00,0x19,0x20,0x0F,0x00,0x08,0x00,0x19,0x00,0x1A,0x22,0x0F,0x00,0x08,0x00,0x19,0x00,0x1B,0x24,0x0F,0x00,0x08,0x00,0x19,0x00,0x1C,0x26,0x0F,0x00,0x08,0x00,0x19,0x00,0x1D,0x28,0x0F,0x00,0x08,0x00,0x19,0x00,0x79,0x30,0x0F,0x00,0x08,0x00,0x19,0x00,0x7A,0x32,0x0F,0x00,0x08,0x00,0x19,0x00,0x7B,0x34,0x0F,0x00,0x08,0x00,0x19,0x00,0x7C,0x36,0x0F,0x00,0x08,0x00,0x19,0x00,0x7D,0x38,0x0F,0x00,0x08,0x00,0x19,0x00,0x23,0x20,0x0F,0x00,0x0F,0x00,0x19,0x00,0x24,0x22,0x0F,0x00,0x0F,
	32 ,0x00,0x18,0x40,0x00,0x19,0x00,0x25,0x24,0x0F,0x00,0x0F,0x00,0x19,0x00,0x26,0x26,0x0F,0x00,0x0F,0x00,0x19,0x00,0x27,0x28,0x0F,0x00,0x0F,0x00,0x19,0x00,0x83,0x30,0x0F,0x00,0x0F,0x00,0x19,0x00,0x84,0x32,0x0F,0x00,0x0F,0x00,0x19,0x00,0x85,0x34,0x0F,0x00,0x0F,0x00,0x19,0x00,0x86,0x36,0x0F,0x00,0x0F,0x00,0x19,0x00,0x87,0x38,0x0F,0x00,0x0F,0x00,0x19,0x00,0x28,0x20,0x0F,0x00,0x0E,0x00,0x19,0x00,0x29,0x22,0x0F,0x00,0x0E,0x00,0x19,0x00,0x2A,0x24,0x0F,0x00,0x0E,0x00,0x19,0x00,0x2B,0x26,0x0F,0x00,0x0E,0x00,0x19,0x00,0x2C,0x28,0x0F,0x00,0x0E,0x00,0x19,0x00,0x88,0x30,0x0F,0x00,0x0E,0x00,0x19,0x00,0x89,0x32,0x0F,0x00,0x0E,0x00,0x19,0x00,0x8A,0x34,0x0F,0x00,0x0E,
	32 ,0x00,0x18,0x60,0x00,0x19,0x00,0x8B,0x36,0x0F,0x00,0x0E,0x00,0x19,0x00,0x8C,0x38,0x0F,0x00,0x0E,0x00,0x10,0x00,0x02,0x10,0x17,0x00,0x09,0x00,0x10,0x00,0x01,0x10,0x17,0x00,0x08,0x00,0x19,0x00,0x36,0x22,0x10,0x00,0x05,0x00,0x19,0x00,0x96,0x32,0x10,0x00,0x05,0x00,0x10,0x00,0x02,0x12,0x17,0x00,0x0B,0x00,0x10,0x00,0x01,0x12,0x17,0x00,0x0A,0x00,0x19,0x00,0x37,0x24,0x10,0x00,0x05,0x00,0x19,0x00,0x97,0x34,0x10,0x00,0x05,0x00,0x19,0x00,0x9F,0x34,0x06,0x00,0x04,0x00,0x19,0x00,0x9E,0x34,0x06,0x00,0x03,0x00,0x10,0x00,0x02,0x24,0x19,0x00,0x3F,0x00,0x10,0x00,0x01,0x24,0x19,0x00,0x3E,0x00,0x10,0x00,0x02,0x26,0x19,0x00,0x62,0x00,0x10,0x00,0x02,0x36,0x19,0x00,0xC2,
	32 ,0x00,0x18,0x80,0x00,0x10,0x00,0x01,0x26,0x19,0x00,0x63,0x00,0x10,0x00,0x01,0x36,0x19,0x00,0xC3,0x00,0x19,0x00,0x3C,0x28,0x10,0x00,0x07,0x00,0x19,0x00,0x9C,0x38,0x10,0x00,0x07,0x00,0x19,0x00,0x3D,0x28,0x10,0x00,0x05,0x00,0x19,0x00,0x9D,0x38,0x10,0x00,0x05,0x00,0x19,0x02,0x39,0x28,0x0F,0x00,0x12,0x00,0x19,0x02,0x99,0x38,0x0F,0x00,0x12,0x00,0x0E,0x00,0x20,0x20,0x19,0x00,0x64,0x00,0x0E,0x00,0x20,0x22,0x19,0x00,0x65,0x00,0x0E,0x00,0x20,0x24,0x19,0x00,0x66,0x00,0x0E,0x00,0x20,0x26,0x19,0x00,0x67,0x00,0x0E,0x00,0x20,0x28,0x19,0x00,0x68,0x00,0x0E,0x00,0x20,0x30,0x19,0x00,0xC4,0x00,0x0E,0x00,0x20,0x32,0x19,0x00,0xC5,0x00,0x0E,0x00,0x20,0x34,0x19,0x00,0xC6,
	32 ,0x00,0x18,0xA0,0x00,0x0E,0x00,0x20,0x36,0x19,0x00,0xC7,0x00,0x0E,0x00,0x20,0x38,0x19,0x00,0xC8,0x00,0x08,0x06,0x00,0x26,0x19,0x00,0x4C,0x00,0x08,0x06,0x00,0x36,0x19,0x00,0xAC,0x00,0x08,0x05,0x00,0x26,0x19,0x00,0x4D,0x00,0x08,0x05,0x00,0x36,0x19,0x00,0xAD,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x18,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x18,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x19,0x00,0x00,0x19,0x00,0x31,0x21,0x0E,0x06,0x06,0x00,0x19,0x00,0x91,0x31,0x0E,0x06,0x06,0x00,0x06,0x00,0x01,0x03,0x17,0x00,0x0A,0x00,0x06,0x00,0x02,0x03,0x17,0x00,0x0B,0x00,0x19,0x00,0x38,0x25,0x10,0x00,0x05,0x00,0x19,0x00,0x2D,0x21,0x0E,0x06,0x10,0x00,0x19,0x00,0x8D,0x31,0x0E,0x06,0x10,0x00,0x19,0x00,0x2E,0x21,0x0E,0x06,0x11,0x00,0x19,0x00,0x8E,0x31,0x0E,0x06,0x11,0x00,0x19,0x00,0x2F,0x21,0x0E,0x06,0x08,0x00,0x19,0x00,0x8F,0x31,0x0E,0x06,0x08,0x00,0x19,0x00,0x30,0x21,0x0E,0x06,0x09,0x00,0x19,0x00,0x90,0x31,0x0E,0x06,0x09,0x00,0x19,0x00,0x32,0x21,0x0E,0x06,0x18,0x00,0x19,0x00,0x92,0x31,0x0E,0x06,0x18,0x00,0x19,0x00,0x33,0x21,0x0E,0x06,0x19,
	32 ,0x00,0x19,0x20,0x00,0x19,0x00,0x93,0x31,0x0E,0x06,0x19,0x00,0x19,0x00,0xDC,0x41,0x13,0x08,0x00,0x00,0x19,0x00,0x3A,0x25,0x17,0x00,0x2A,0x00,0x19,0x00,0x3B,0x25,0x17,0x00,0x2B,0x00,0x19,0x00,0x9A,0x35,0x17,0x00,0x2A,0x00,0x19,0x00,0x9B,0x35,0x17,0x00,0x2B,0x00,0x16,0x00,0x05,0x25,0x19,0x00,0x4E,0x00,0x0E,0x00,0x0C,0x23,0x19,0x00,0x50,0x00,0x0E,0x00,0x0C,0x33,0x19,0x00,0xB0,0x00,0x0E,0x00,0x0D,0x23,0x19,0x00,0x51,0x00,0x0E,0x00,0x0D,0x33,0x19,0x00,0xB1,0x00,0x16,0x00,0x05,0x35,0x19,0x00,0xAE,0x00,0x16,0x00,0x04,0x25,0x19,0x00,0x4F,0x00,0x16,0x00,0x04,0x35,0x19,0x00,0xAF,0x00,0x0E,0x00,0x28,0x23,0x19,0x00,0x54,0x00,0x0E,0x00,0x28,0x33,0x19,0x00,0xB4,
	32 ,0x00,0x19,0x40,0x00,0x0E,0x00,0x29,0x23,0x19,0x00,0x55,0x00,0x0E,0x00,0x29,0x33,0x19,0x00,0xB5,0x00,0x0E,0x00,0x2A,0x23,0x19,0x00,0x56,0x00,0x0E,0x00,0x2A,0x33,0x19,0x00,0xB6,0x00,0x0E,0x00,0x2B,0x23,0x19,0x00,0x57,0x00,0x0E,0x00,0x2B,0x33,0x19,0x00,0xB7,0x00,0x0E,0x06,0x21,0x23,0x19,0x00,0x5F,0x00,0x0E,0x06,0x24,0x23,0x19,0x00,0x60,0x00,0x0E,0x06,0x20,0x33,0x19,0x00,0xC1,0x00,0x0F,0x08,0x06,0x41,0x19,0x00,0xDA,0x00,0x0E,0x04,0x00,0x17,0x19,0x00,0xDD,0x00,0x0E,0x04,0x01,0x17,0x19,0x00,0xDE,0x00,0x0E,0x04,0x02,0x17,0x19,0x00,0xDF,0x00,0x0E,0x04,0x03,0x17,0x19,0x00,0xE0,0x00,0x0E,0x04,0x04,0x17,0x19,0x00,0xE1,0x00,0x0E,0x04,0x05,0x17,0x19,0x00,0xE2,
	32 ,0x00,0x19,0x60,0x00,0x0E,0x04,0x06,0x17,0x19,0x00,0xE3,0x00,0x0E,0x04,0x07,0x19,0x19,0x00,0xE4,0x00,0x0E,0x04,0x08,0x19,0x19,0x00,0xE5,0x00,0x0E,0x04,0x09,0x19,0x19,0x00,0xE6,0x00,0x0E,0x04,0x0A,0x19,0x19,0x00,0xE7,0x00,0x0E,0x04,0x0B,0x19,0x19,0x00,0xE8,0x00,0x0E,0x04,0x0C,0x19,0x19,0x00,0xE9,0x00,0x0E,0x04,0x0D,0x19,0x19,0x00,0xEA,0x00,0x17,0x00,0x24,0x25,0x19,0x00,0x52,0x00,0x17,0x00,0x25,0x25,0x19,0x00,0x53,0x00,0x17,0x00,0x24,0x35,0x19,0x00,0xB2,0x00,0x17,0x00,0x25,0x35,0x19,0x00,0xB3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x19,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x19,0x00,0x34,0x25,0x09,0x08,0x80,0x00,0x19,0x00,0x94,0x35,0x09,0x08,0x80,0x00,0x19,0x00,0x35,0x25,0x09,0x08,0x00,0x00,0x19,0x00,0x95,0x35,0x09,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x19,0xA0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x19,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	32 ,0x00,0x19,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x19,0x06,0xFF,0x19,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	1 ,0x00,0xF0,0x5B,0x00,0x11,0x00,0x00,
	11 ,0x00,0xF0,0x68,0x14,0x7B,0x00,0x00,0x7F,0xEF,0x00,0x00,0x04,0x19,0x00,0x00,0x7F,0xDE,0x00,0x00,0x00,0x0A,0x00,0x00,0xFF,0xF8,0x00,0x00,0xFF,0xFE,0x00,0x00,0x00,0x04,0x00,0x00,0x20,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x40,0x00,0x00,0x00,
	25 ,0x00,0xF0,0x74,0x20,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x01,0x60,0x00,0x00,0x01,0x70,0x00,0x00,0x01,0x80,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x20,0x00,0x00,0x7E,0xB7,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x20,0x00,0x00,0x02,0x50,0x00,0x00,0x10,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x0A,0x00,0x00,0x08,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x0C,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0xFA,0x00,0x00,0x00,0x1C,0x00,0x00,0x2C,0x88,0x00,0x00,
	8 ,0x00,0xF0,0x8E,0x0F,0xA0,0x00,0x00,0x00,0x1C,0x00,0x00,0x07,0xD0,0x00,0x00,0x7F,0xFF,0x00,0x00,0x00,0x0A,0x00,0x00,0xFC,0x18,0x00,0x00,0x00,0x32,0x00,0x00,0x00,0x7D,0x00,0x00,
	18 ,0x00,0xF0,0x48,0x02,0x00,0x00,0x00,0x7D,0x00,0x00,0x00,0x7F,0xFF,0x00,0x00,0x7D,0x00,0x00,0x00,0x00,0x14,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x2F,0x00,0x00,0x00,0x1F,0x00,0x00,0x00,0x80,0x00,0x00,0x15,0x00,0x00,0x00,0x00,0x11,0x00,0x00,0x00,0x11,0x00,0x00,0x06,0x66,0x00,0x00,0x0C,0xCC,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,
	2 ,0x00,0xE0,0x08,0x00,0x00,0x00,0x00,0x7F,0xFF,0x00,0x00,
	2 ,0x00,0xE0,0x14,0x20,0x00,0x00,0x00,0x60,0x00,0x00,0x00,
	2 ,0x00,0xE0,0x21,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,
	2 ,0x00,0xE5,0x00,0x00,0x19,0x02,0x00,0x00,0x00,0x00,0x9A,
	2 ,0x00,0xE3,0x78,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	2 ,0x00,0xE6,0x22,0x04,0x00,0x00,0x00,0x73,0x00,0x00,0x00,
	2 ,0x00,0xE3,0x0E,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	2 ,0x00,0xE3,0x1E,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	2 ,0x00,0xE3,0x4E,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	1 ,0x01,0x70,0x02,0x00,0x00,0x00,0x00,
	1 ,0x01,0x70,0x21,0x00,0x00,0x00,0x00,
	1 ,0x01,0x70,0x20,0x00,0x02,0x40,0x00,
	3 ,0x01,0x70,0x26,0x00,0x00,0xE0,0x00,0x00,0x00,0xE0,0x00,0x80,0x01,0xC0,0x00,
	1 ,0x00,0x30,0x02,0x00,0x00,0x00,0x00,
	1 ,0x00,0x30,0x01,0x00,0x00,0x14,0xFF,
	1 ,0x01,0x00,0x00,0x00,0x00,0x00,0x01,
	1 ,0x01,0x00,0x04,0x00,0x19,0x00,0x00,
	1 ,0x00,0xE0,0x00,0x00,0x08,0x08,0x01,
	2 ,0x00,0xF0,0x00,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x00,
	1 ,0x00,0xF8,0x02,0x00,0x00,0x00,0x01,
	1 ,0x00,0x20,0x00,0x00,0x00,0x10,0x01,
	1 ,0x00,0x10,0x00,0x00,0x00,0x00,0x31,
	1 ,0x01,0x30,0x00,0x70,0x00,0x00,0x15,
	1 ,0x00,0x60,0x00,0x00,0x00,0x1F,0x01,
	32 ,0x00,0x68,0x00,0x00,0x23,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0xD0,0x00,0x00,0x00,0x00,0x00,0x00,0x79,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0xC8,0xF0,0x00,0x00,0x00,0x00,0x00,0x01,0x33,0xA0,0x00,0x00,0x00,0x00,0x00,0x01,0xBB,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x5E,0x50,0x00,0x00,0x00,0x00,0x00,0x03,0x1A,0x70,0x00,0x00,0x00,0x00,0x00,0x03,0xE9,0x90,0x00,0x00,0x00,0x00,0x00,0x04,0xC3,0x40,0x00,0x00,0x00,0x00,0x00,0x05,0x9D,0x60,0x00,0x00,0x00,0x00,0x00,0x06,0x6C,0x40,0x00,0x00,0x00,0x00,0x00,0x07,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xB9,0x50,0x00,0x00,0x00,0x00,0x00,0x08,0x22,0xC0,0x00,0x00,0x00,0x00,0x00,0x08,0x59,0x40,0x00,0x00,0x00,0x00,0x00,
	1 ,0x00,0x60,0x00,0x00,0x00,0x1F,0x21,
	0xFF,
};

static const uint8 TDA778x_FMSWPatchData[]=
{
	0xFF
};

static const uint8 TDA778x_FMCustomWSPData[]=
{
#if 0//ST分离20-35dB，关闭softmute
	1 ,0x01,0xB1,0xAA,0x40,0x00,0x00,0x00,
	1 ,0x01,0xB1,0xA9,0x00,0x00,0x00,0x00,
	1 ,0x01,0xB1,0xA8,0x00,0x00,0x00,0x00,
	1 ,0x01,0xB0,0xD4,0x1F,0xBB,0xBB,0x00,
	1 ,0x01,0xB0,0xB1,0x35,0x55,0x55,0x00,
	1 ,0x01,0xB0,0xB2,0x35,0x55,0x55,0x00,
	0xFF,
#else//ST分离30-50dB，关闭softmute //2020.08.29修改用这个
	1 ,0x01,0xB1,0xAA,0x40,0x00,0x00,0x00,
	1 ,0x01,0xB1,0xA9,0x00,0x00,0x00,0x00,
	1 ,0x01,0xB1,0xA8,0x00,0x00,0x00,0x00,
	1 ,0x01,0xB0,0xD4,0x2B,0x1C,0x71,0x00,
	1 ,0x01,0xB0,0xB1,0x58,0xE3,0x8E,0x00,
	1 ,0x01,0xB0,0xB2,0x58,0xE3,0x8E,0x00,
	0xFF,
#endif
};

static const uint8 TDA778x_AMSWPatchData[]=
{
	0xFF
};

static const uint8 TDA778x_AMCustomWSPData[]=
{
	0xFF
};

static const uint8 TDA778x_WXSWPatchData[]=
{
	0xFF
};

static const uint8 TDA778x_WXCustomWSPData[]=
{
	0xFF
};

const uint8 TDA778x_FMFEReg[]=
{
	0x40,0x00,0x04, //FE register 0
	0x08,0xB4,0x38, //FE register 1
	0xF8,0x00,0x18, //FE register 2
	0xB3,0x0D,0x23, //FE register 3
	0xF0,0x07,0x24, //FE register 4
	0xBD,0x5C,0x18, //FE register 5
	0x40,0x00,0x22, //FE register 6
	0x08,0x20,0x03, //FE register 7
	0x0F,0x63,0x53, //FE register 8
	0x00,0x00,0x10, //FE register 9
	0x00,0x00,0x00	//FE register 15
};

const uint8 TDA778x_WXFEReg[]=
{
	0x40,0x00,0x04, //FE register 0
	0x0F,0xD4,0x38, //FE register 1
	0xF8,0x00,0x1A, //FE register 2
	0xB3,0x0D,0x23, //FE register 3
	0xF0,0x03,0x24, //FE register 4
	0xBD,0x5C,0x18, //FE register 5
	0x40,0x00,0x22, //FE register 6
	0x08,0x20,0x03, //FE register 7
	0x0F,0x63,0x53, //FE register 8
	0x00,0x00,0x10, //FE register 9
	0x00,0x00,0x00	//FE register 15
};

const uint8 TDA778x_AMFEReg[]=
{
	0x62,0x03,0x85, //FE register 0
	0x17,0x0C,0x38, //FE register 1
	0xFC,0x00,0x08, //FE register 2
	0xB7,0x19,0x43, //FE register 3
	0xB0,0x0F,0x24, //FE register 4
	0xBD,0x5C,0x18, //FE register 5
	0x40,0x00,0x22, //FE register 6
	0x08,0x20,0x03, //FE register 7
	0x1F,0x03,0x53, //FE register 8
	0x00,0x00,0x10, //FE register 9
	0x00,0x00,0x00	//FE register 15
};

/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
static uint8 tda778x_cmd_set_becoeff(const uint8 *p_be_coeff)
{
	uint8 num,num_word;
	uint8 i;
	uint32 addr;
	uint8 cmdcode;
	uint8 offset;

	while(*p_be_coeff != 0xff )
	{
		num = num_word = p_be_coeff[0];
		addr = _u8tou32_(0x00, p_be_coeff[1], p_be_coeff[2], p_be_coeff[3]);
		offset = 0;

		if((addr <= 0x019fff)||((addr >= 0x01c000)&&(addr <= 0x01ffff)))
		{
			cmdcode = CmdCode_WriteDMAmem;
		}
		else if((addr >= 0x01a000)&&(addr <= 0x01afff))
		{
			cmdcode = CmdCode_Writemen;
		}
		else if((addr >= 0x01b000)&&(addr <= 0x01bfff))
		{
			cmdcode = CmdCode_Writemen;
		}

		if(cmdcode == CmdCode_WriteDMAmem)
		{
			for(i = 0; i < num; i++)
			{
				tda778x_write_addr[0] = _u32to8hl_(addr);		//Para 1  memory address
				tda778x_write_addr[1] = _u32to8lh_(addr);
				tda778x_write_addr[2] = _u32to8ll_(addr);
				tda778x_write_addr[3] = p_be_coeff[4 + i*4];	//Para 2
				tda778x_write_addr[4] = p_be_coeff[5 + i*4];
				tda778x_write_addr[5] = p_be_coeff[6 + i*4];
				tda778x_write_addr[6] = tda778x_write_addr[4];
				tda778x_write_addr[7] = tda778x_write_addr[5];
				tda778x_write_addr[8] = p_be_coeff[7 + i*4];

				if(!tda778x_cmd_write_read(cmdcode, 3, 1))return FALSE;

				addr++;
			}

			p_be_coeff += num_word*4 + 4;
		}
		else if(cmdcode == CmdCode_Writemen)
		{
			while(num > 7)
			{
				tda778x_write_addr[0] = _u32to8hl_(addr);		//Para 1  memory address
				tda778x_write_addr[1] = _u32to8lh_(addr);
				tda778x_write_addr[2] = _u32to8ll_(addr);

				for(i = 0; i < 7; i++)
				{
					tda778x_write_addr[3 + i*3] = p_be_coeff[4 + i*4 + offset];//Para 2
					tda778x_write_addr[4 + i*3] = p_be_coeff[5 + i*4 + offset];
					tda778x_write_addr[5 + i*3] = p_be_coeff[6 + i*4 + offset];
				}

				if(!tda778x_cmd_write_read(cmdcode, 8, 1))return FALSE;

				addr++;
				offset += 4*7;
				num -= 7;
			}

			tda778x_write_addr[0] = _u32to8hl_(addr);		//Para 1  memory address
			tda778x_write_addr[1] = _u32to8lh_(addr);
			tda778x_write_addr[2] = _u32to8ll_(addr);

			for(i = 0; i < num; i++)
			{
				tda778x_write_addr[3 + i*3] = p_be_coeff[4 + i*4 + offset];//Para 2
				tda778x_write_addr[4 + i*3] = p_be_coeff[5 + i*4 + offset];
				tda778x_write_addr[5 + i*3] = p_be_coeff[6 + i*4 + offset];
			}

			if(!tda778x_cmd_write_read(cmdcode, num+1, 1))return FALSE;

			p_be_coeff += num_word*4 + 4;
		}
	}

	return TRUE;
}

static uint8 tda778x_cmd_set_mem(uint32 menAddr, uint32 menData)
{
	if((menAddr >= 0x01a000) && (menAddr <= 0x01bfff))
	{
		tda778x_write_addr[0] 	= _u32to8hl_(menAddr);
		tda778x_write_addr[1]	= _u32to8lh_(menAddr);
		tda778x_write_addr[2]	= _u32to8ll_(menAddr);
		tda778x_write_addr[3]	= _u32to8hl_(menData);
		tda778x_write_addr[4]	= _u32to8lh_(menData);
		tda778x_write_addr[5]	= _u32to8ll_(menData);
		return tda778x_cmd_write_read(CmdCode_Writemen, 2, 1);
	}
	else
	{
		tda778x_write_addr[0] 	= _u32to8hl_(menAddr);
		tda778x_write_addr[1]	= _u32to8lh_(menAddr);
		tda778x_write_addr[2]	= _u32to8ll_(menAddr);
		tda778x_write_addr[3]	= _u32to8hh_(menData);
		tda778x_write_addr[4]	= _u32to8hl_(menData);
		tda778x_write_addr[5]	= _u32to8lh_(menData);
		tda778x_write_addr[6]	= _u32to8hl_(menData);
		tda778x_write_addr[7]	= _u32to8lh_(menData);
		tda778x_write_addr[8]	= _u32to8ll_(menData);
		return tda778x_cmd_write_read(CmdCode_WriteDMAmem, 3, 1);
	}

	return FALSE;
}

static uint8  tda778x_cmd_get_mem(uint32 menAddr, uint8 Numword)
{
	if((menAddr >= 0x01a000) && (menAddr <= 0x01bfff))
	{
		tda778x_write_addr[0] 	= _u32to8hl_(menAddr);
		tda778x_write_addr[1]	= _u32to8lh_(menAddr);
		tda778x_write_addr[2]	= _u32to8ll_(menAddr);
		tda778x_write_addr[3]	= 0x00;
		tda778x_write_addr[4]	= 0x00;
		tda778x_write_addr[5]	= Numword;

		return tda778x_cmd_write_read(CmdCode_Readmen, 2, Numword + 1);
	}
	else
	{
		tda778x_write_addr[0] 	= _u32to8hl_(menAddr);
		tda778x_write_addr[1]	= _u32to8lh_(menAddr);
		tda778x_write_addr[2]	= _u32to8ll_(menAddr);
		tda778x_write_addr[3]	= 0x00;
		tda778x_write_addr[4]	= 0x00;
		tda778x_write_addr[5]	= Numword * 2;

		return tda778x_cmd_write_read(CmdCode_ReadDMAmem, 2, Numword * 2 + 1);
	}
	return FALSE;
}

static uint8  tda778x_cmd_get_TDSR(uint8 *AlignDone, uint8 *IS, uint8 *TDBusy)
{
	if(!tda778x_cmd_write_read(CmdCode_ReadTDS, 0, 1+1+1))return FALSE;	//add read out checksum

	if(tda778x_read_addr[4] & 0x04)
	{
		*AlignDone = 1;
	}
	else
	{
		*AlignDone = 0;
	}

	if(tda778x_read_addr[4] & 0x08)
	{
		*IS = 1;
	}
	else
	{
		*IS = 0;
	}

	if(tda778x_read_addr[5] & 0x40)
	{
		*TDBusy = 1;
	}
	else
	{
		*TDBusy = 0;
	}

	return TRUE;
}

static uint8 tda778x_cmd_get_stereo(uint8 *stereo)
{
	if(!tda778x_cmd_get_mem(0x01a0fa, 1))return FALSE;

	if((tda778x_read_addr[3] == 0x7F)&&(tda778x_read_addr[4] == 0xFF)&&(tda778x_read_addr[5] == 0xFC))//means the pilot is higher than the threshold ST_PILOT_DET_TH
	{
		*stereo = 1;
	}
	else
	{
		*stereo = 0;
	}

	return TRUE;
}

static uint8 tda778x_cmd_get_smeter(tda778x_band_e band, uint8 *smeter,uint8 *detun,uint8 *dummy)
{
	if(band == TDA778x_BAND_FM)
	{
		if(!tda778x_cmd_get_mem(0x01a03e, 2))return FALSE;
		*smeter = tda778x_read_addr[3];
		*detun = tda778x_read_addr[4];
		*dummy = tda778x_read_addr[5];

	}
	else if(band == TDA778x_BAND_AM)
	{
		if(!tda778x_cmd_get_mem(0x01a1b9, 2))return FALSE;
		*smeter = tda778x_read_addr[3];
		*detun = tda778x_read_addr[4];
		*dummy = tda778x_read_addr[5];
	}
	else return FALSE;

	return TRUE;
}


static uint8 tda778x_wait_busy(void)
{
	uint8 AlignDone;
	uint8 IS;
	uint8 TDBusy;
	uint8 time_over = 100;

	while(--time_over)
	{
		if(!tda778x_cmd_get_TDSR(&AlignDone, &IS, &TDBusy))return FALSE;
		if(!TDBusy)return TRUE;
		OSTimeDly(1);
	}

	return FALSE;
}

static uint8 tda778x_startup_reset(void)
{
	tda778x_order.addr[0] 	= 0x01;
	tda778x_order.addr[1] 	= 0x40;
	tda778x_order.addr[2] 	= 0x06;

	if(!tda778x_direct_read(TDA778x_COM_1))return FALSE;

	return TRUE;
}

static uint8 tda778x_startup_sequence(void)
{
	tda778x_order.addr[0] 	= 0x01;
	tda778x_order.addr[1] 	= 0x90;
	tda778x_order.addr[2] 	= 0xEB;

	if(!tda778x_direct_read(TDA778x_COM_1))return FALSE;

	if((tda778x_read_addr[0] != 0xAF)
	 ||(tda778x_read_addr[1] != 0xFE)
	 ||(tda778x_read_addr[2] != 0x42)
	 ||(tda778x_read_addr[3] != 0x00))
	{
		return FALSE;
	}

	return TRUE;
}

static uint8 tda778x_cmd_init_stereo(void)
{
	if(!tda778x_cmd_get_mem(PILOT_THS_ADDR, 1))return FALSE;

	tda778x_ctrl->pilotth = _u8tou32_(0x00, tda778x_read_addr[3], tda778x_read_addr[4], tda778x_read_addr[5]);
	return TRUE;
}

static uint8 tda778x_cmd_set_diss(uint8 mode, uint8 bandwidth)
{
	tda778x_write_addr[0] = 0x00;		//Para1
	tda778x_write_addr[1] = 0x00;
	tda778x_write_addr[2] = mode;

	if((mode == Diss_FM_Manual)||(mode == Diss_FM_Special))
	{
		tda778x_write_addr[3] = 0x00;	//Para2
		tda778x_write_addr[4] = 0x00;
		tda778x_write_addr[5] = bandwidth;

		return tda778x_cmd_write_read(CmdCode_SetDiss, 2, 1);
	}
	else
	{
		return tda778x_cmd_write_read(CmdCode_SetDiss, 1, 1);
	}
	return FALSE;//add
}

static uint8 tda778x_cmd_set_FEReg(tda778x_band_e band, uint8 start, uint8 num)
{
	uint8 i;

	if(num == 0)
	{
		return tda778x_cmd_write_read(CmdCode_SetFEReg, 0, 1);
	}
	else
	{
		//set FE registers to user-specified values, starting from specified subaddress
		tda778x_write_addr[0] = 0x00;//para 1---Subaddress
		tda778x_write_addr[1] = 0x00;
		tda778x_write_addr[2] = start;

		if(start == 15)
		{
			if(band == TDA778x_BAND_FM)
			{
				tda778x_write_addr[3] = TDA778x_FMFEReg[10*3 + 0];
				tda778x_write_addr[4] = TDA778x_FMFEReg[10*3 + 1];
				tda778x_write_addr[5] = TDA778x_FMFEReg[10*3 + 2];
			}
			else if(band == TDA778x_BAND_WB)
			{
				tda778x_write_addr[3] = TDA778x_WXFEReg[10*3 + 0];
				tda778x_write_addr[4] = TDA778x_WXFEReg[10*3 + 1];
				tda778x_write_addr[5] = TDA778x_WXFEReg[10*3 + 2];
			}
			else
			{
				tda778x_write_addr[3] = TDA778x_AMFEReg[10*3 + 0];
				tda778x_write_addr[4] = TDA778x_AMFEReg[10*3 + 1];
				tda778x_write_addr[5] = TDA778x_AMFEReg[10*3 + 2];
			}
		}
		else
		{
			if(band == TDA778x_BAND_FM)
			{
				for(i = 0; i < num; i++)
				{
					tda778x_write_addr[3 + i*3] = TDA778x_FMFEReg[start*3 + i*3 + 0];
					tda778x_write_addr[4 + i*3] = TDA778x_FMFEReg[start*3 + i*3 + 1];
					tda778x_write_addr[5 + i*3] = TDA778x_FMFEReg[start*3 + i*3 + 2];
				}
			}
			else if(band == TDA778x_BAND_WB)
			{
				for(i = 0; i < num; i++)
				{
					tda778x_write_addr[3 + i*3] = TDA778x_WXFEReg[start*3 + i*3 + 0];
					tda778x_write_addr[4 + i*3] = TDA778x_WXFEReg[start*3 + i*3 + 1];
					tda778x_write_addr[5 + i*3] = TDA778x_WXFEReg[start*3 + i*3 + 2];
				}
			}
			else
			{
				for(i = 0; i < num; i++)
				{
					tda778x_write_addr[3 + i*3] = TDA778x_AMFEReg[start*3 + i*3 + 0];
					tda778x_write_addr[4 + i*3] = TDA778x_AMFEReg[start*3 + i*3 + 1];
					tda778x_write_addr[5 + i*3] = TDA778x_AMFEReg[start*3 + i*3 + 2];
				}
			}
		}

		return tda778x_cmd_write_read(CmdCode_SetFEReg, num + 1, 1);
	}
	return FALSE;//add
}

static uint8 tda778x_cmd_set_freq(tda778x_band_e band, uint16 set_freq)
{
	uint32 freq;

	switch(band)
	{
		case TDA778x_BAND_FM:
			freq = set_freq * 10;
			break;

		case TDA778x_BAND_WB:
			freq = set_freq + 100000;
			break;

		case TDA778x_BAND_AM:
			freq = set_freq;
			break;

		case TDA778x_BAND_SW:
			freq = (set_freq - 1384) * 5;
			break;

		default:
			freq = set_freq;
			break;

	}

	tda778x_write_addr[0] = _u32to8hl_(freq);
	tda778x_write_addr[1] = _u32to8lh_(freq);
	tda778x_write_addr[2] = _u32to8ll_(freq);

	tda778x_write_addr[3] = 0x00;
	tda778x_write_addr[4] = 0x00;
	tda778x_write_addr[5] = InjectSide_Auto;

	return tda778x_cmd_write_read(CmdCode_SetFreq, 2, 1);
}

static uint8 tda778x_cmd_set_start_align(uint8 AlignMode)
{
	tda778x_write_addr[0] = 0x00;
	tda778x_write_addr[1] = 0x00;
	tda778x_write_addr[2] = AlignMode & 0x03;

	return tda778x_cmd_write_read(CmdCode_StartAlignment, 1, 1);
}

static uint8 tda778x_hit_download(tda778x_hit_e hit_type)
{
	uint8 r = FALSE;

	switch(hit_type)
	{
		case TDA778x_HIT_BOOT:
			r = Write_TDA778x_Download(TDA778x_I2CBootData);
			break;

		case TDA778x_HIT_FM_PATCH:
			r = tda778x_cmd_set_becoeff(TDA778x_FMSWPatchData);
			break;

		case TDA778x_HIT_AM_PATCH:
			r = tda778x_cmd_set_becoeff(TDA778x_AMSWPatchData);
			break;

		case TDA778x_HIT_WX_PATCH:
			r = tda778x_cmd_set_becoeff(TDA778x_WXSWPatchData);
			break;

		case TDA778x_HIT_FM_WSP:
			r = tda778x_cmd_set_becoeff(TDA778x_FMCustomWSPData);
			break;

		case TDA778x_HIT_AM_WSP:
			r = tda778x_cmd_set_becoeff(TDA778x_AMCustomWSPData);
			break;

		case TDA778x_HIT_WX_WSP:
			r = tda778x_cmd_set_becoeff(TDA778x_WXCustomWSPData);
			break;

		default:
			break;
	}

	return r;
}

static uint8 tda778x_check_ESD_crashed(void)
{
	uint8 read_smeter_log[3];
	uint8 read_sysco_reg1[3];
	uint8 k1 = 0,k2 = 0,k3 = 0,k4 = 0;

	tda778x_ctrl->cmd_check = TRUE;

	if(!tda778x_cmd_get_mem(0x01a0f9, 1))//FM_Smeter(log)
	{
		k4 = 1;
	}
	read_smeter_log[0] = tda778x_read_addr[3];
	read_smeter_log[1] = tda778x_read_addr[4];
	read_smeter_log[2] = tda778x_read_addr[5];

	if(!tda778x_cmd_get_mem(0x014001, 1))//SYSCO_REG1
	{
		k4 = 1;
	}
	read_sysco_reg1[0] = tda778x_read_addr[3];
	read_sysco_reg1[1] = tda778x_read_addr[4];
	read_sysco_reg1[2] = tda778x_read_addr[5];

	tda778x_ctrl->cmd_check = FALSE;

	if((read_sysco_reg1[1] != 0x02)&&(read_sysco_reg1[2] != 0x7B))      //TDA7703=0X00027B,TDA7706M=0X80027B
	{
		k1 = 1;
	}
	if((read_sysco_reg1[1] == read_smeter_log[1])&&(read_sysco_reg1[2] == read_smeter_log[2]))
	{
		k2 = 1;
	}
	if((read_smeter_log[0] == 0)&&(read_smeter_log[1] == 0)&&(read_smeter_log[2] == 0))
	{
		k3 = 1;
	}

	if((k1==1)||(k2==1)||(k3==1)||(k4==1))
	{
		return FALSE;
	}

	return TRUE;
}

static uint8 tda778x_cmd_set_DDC(void)
{
	return tda778x_cmd_write_read(CmdCode_SetDDC, 0, 1);
}

static uint8 tda778x_cmd_set_IR_type(uint8 type)
{
	tda778x_write_addr[0] = 0x00;
	tda778x_write_addr[1] = 0x00;
	tda778x_write_addr[2] = type;

	return tda778x_cmd_write_read(CmdCode_IR, 1, 1);
}

static uint8 tda778x_cmd_set_MuSICA(uint8 val)
{
	tda778x_write_addr[0] = 0x00;
	tda778x_write_addr[1] = 0x00;
	tda778x_write_addr[2] = val;

	return tda778x_cmd_write_read(CmdCode_MuSICA, 1, 1);
}

static uint8 tda778x_cmd_set_seekTH(uint32 MeasCycle, uint32 fieldstrengthTH, uint32 AdjTH, uint32 DetuneTH, uint32 MultipathTH, uint32 QualityTH)
{
	uint8 index = 0;

	tda778x_write_addr[index++] = _u32to8hl_(MeasCycle);
	tda778x_write_addr[index++] = _u32to8lh_(MeasCycle);
	tda778x_write_addr[index++] = _u32to8ll_(MeasCycle);

	tda778x_write_addr[index++] = _u32to8hl_(fieldstrengthTH);
	tda778x_write_addr[index++] = _u32to8lh_(fieldstrengthTH);
	tda778x_write_addr[index++] = _u32to8ll_(fieldstrengthTH);

	tda778x_write_addr[index++] = _u32to8hl_(AdjTH);
	tda778x_write_addr[index++] = _u32to8lh_(AdjTH);
	tda778x_write_addr[index++] = _u32to8ll_(AdjTH);

	tda778x_write_addr[index++] = _u32to8hl_(DetuneTH);
	tda778x_write_addr[index++] = _u32to8lh_(DetuneTH);
	tda778x_write_addr[index++] = _u32to8ll_(DetuneTH);

	tda778x_write_addr[index++] = _u32to8hl_(MultipathTH);
	tda778x_write_addr[index++] = _u32to8lh_(MultipathTH);
	tda778x_write_addr[index++] = _u32to8ll_(MultipathTH);

	tda778x_write_addr[index++] = _u32to8hl_(QualityTH);
	tda778x_write_addr[index++] = _u32to8lh_(QualityTH);
	tda778x_write_addr[index++] = _u32to8ll_(QualityTH);

	return tda778x_cmd_write_read(CmdCode_SetSeekTH, 6, 1);
}

static uint8 tda778x_set_loc(tda778x_band_e band, uint8 loc)
{
	if(loc == ON)
	{
		switch(band)
		{
			case TDA778x_BAND_FM:
				if(!tda778x_cmd_set_seekTH(0x000500, TDA778x_TUNER_RSSI_LOC_FM, 0x400000, 0x0a0000, 0x5fffff, 0x554000))return FALSE;
				break;

			case TDA778x_BAND_AM:
			case TDA778x_BAND_SW:
				if(!tda778x_cmd_set_seekTH(0x000700, TDA778x_TUNER_RSSI_LOC_AM, 0x7fffff, 0x200000, 0x7fffff, 0x000000))return FALSE;
				break;

			case TDA778x_BAND_WB:
				if(!tda778x_cmd_set_seekTH(0x000500, 0xC30000, 0x300000, 0x060000, 0x100000, 0x000000))return FALSE;
				break;

			default:
				return FALSE;
		}
	}
	else
	{
		switch(band)
		{
			case TDA778x_BAND_FM:
				if(!tda778x_cmd_set_seekTH(0x000500, TDA778x_TUNER_RSSI_FM, 0x400000, 0x0a0000, 0x5fffff, 0x554000))return FALSE;
				break;

			case TDA778x_BAND_AM:
			case TDA778x_BAND_SW:
				if(!tda778x_cmd_set_seekTH(0x000700, TDA778x_TUNER_RSSI_AM, 0x7fffff, 0x200000, 0x7fffff, 0x000000))return FALSE;
				break;

			case TDA778x_BAND_WB:
				if(!tda778x_cmd_set_seekTH(0x000500, 0xC30000, 0x300000, 0x060000, 0x100000, 0x000000))return FALSE;
				break;

			default:
				return FALSE;
		}
	}
	return TRUE;
}

static uint8 tda778x_cmd_set_band(tda778x_band_e band, uint16 min_freq, uint16 max_freq)
{
	uint8 index = 0;

	if(band == TDA778x_BAND_WB)
	{
		uint32 MinFreq = min_freq + 100000;
		uint32 MaxFreq = max_freq + 100000;

		tda778x_write_addr[index++] = 0x00;
		tda778x_write_addr[index++] = 0x00;
		tda778x_write_addr[index++] = 0x01;

		tda778x_write_addr[index++] = _u32to8hl_(MinFreq);
		tda778x_write_addr[index++] = _u32to8lh_(MinFreq);
		tda778x_write_addr[index++] = _u32to8ll_(MinFreq);

		tda778x_write_addr[index++] = _u32to8hl_(MaxFreq);
		tda778x_write_addr[index++] = _u32to8lh_(MaxFreq);
		tda778x_write_addr[index++] = _u32to8ll_(MaxFreq);

		return tda778x_cmd_write_read(CmdCode_SetBand, 3, 1);
	}
	else if(band == TDA778x_BAND_FM)
	{
		uint32 MinFreq = min_freq * 10;
		uint32 MaxFreq = max_freq * 10;

		tda778x_write_addr[index++] = 0x00;
		tda778x_write_addr[index++] = 0x00;
		tda778x_write_addr[index++] = 0x01;

		tda778x_write_addr[index++] = _u32to8hl_(MinFreq);
		tda778x_write_addr[index++] = _u32to8lh_(MinFreq);
		tda778x_write_addr[index++] = _u32to8ll_(MinFreq);

		tda778x_write_addr[index++] = _u32to8hl_(MaxFreq);
		tda778x_write_addr[index++] = _u32to8lh_(MaxFreq);
		tda778x_write_addr[index++] = _u32to8ll_(MaxFreq);

		return tda778x_cmd_write_read(CmdCode_SetBand, 3, 1);
	}
	else if(band == TDA778x_BAND_AM)
	{
		uint32 MinFreq = min_freq;
		uint32 MaxFreq = max_freq;

		if(((tda778x_ctrl->area == TDA778x_AREA_USA)||(tda778x_ctrl->area==TDA778x_AREA_LATIN)))
		{
			tda778x_write_addr[index++] = 0x00;
			tda778x_write_addr[index++] = 0x00;
			tda778x_write_addr[index++] = 0x03;

			tda778x_write_addr[index++] = _u32to8hl_(MinFreq);
			tda778x_write_addr[index++] = _u32to8lh_(MinFreq);
			tda778x_write_addr[index++] = _u32to8ll_(MinFreq);

			tda778x_write_addr[index++] = _u32to8hl_(MaxFreq);
			tda778x_write_addr[index++] = _u32to8lh_(MaxFreq);
			tda778x_write_addr[index++] = _u32to8ll_(MaxFreq);

			return tda778x_cmd_write_read(CmdCode_SetBand, 3, 1);
		}
		else
		{
			tda778x_write_addr[index++] = 0x00;
			tda778x_write_addr[index++] = 0x00;
			tda778x_write_addr[index++] = 0x02;

			tda778x_write_addr[index++] = _u32to8hl_(MinFreq);
			tda778x_write_addr[index++] = _u32to8lh_(MinFreq);
			tda778x_write_addr[index++] = _u32to8ll_(MinFreq);

			tda778x_write_addr[index++] = _u32to8hl_(MaxFreq);
			tda778x_write_addr[index++] = _u32to8lh_(MaxFreq);
			tda778x_write_addr[index++] = _u32to8ll_(MaxFreq);

			return tda778x_cmd_write_read(CmdCode_SetBand, 3, 1);
		}
	}
	else if(band == TDA778x_BAND_SW)
	{
		uint32 MinFreq = (min_freq - 1384) * 5;
		uint32 MaxFreq = (max_freq - 1384) * 5;

		tda778x_write_addr[index++] = 0x00;
		tda778x_write_addr[index++] = 0x00;
		tda778x_write_addr[index++] = 0x02;

		tda778x_write_addr[index++] = _u32to8hl_(MinFreq);
		tda778x_write_addr[index++] = _u32to8lh_(MinFreq);
		tda778x_write_addr[index++] = _u32to8ll_(MinFreq);

		tda778x_write_addr[index++] = _u32to8hl_(MaxFreq);
		tda778x_write_addr[index++] = _u32to8lh_(MaxFreq);
		tda778x_write_addr[index++] = _u32to8ll_(MaxFreq);

		return tda778x_cmd_write_read(CmdCode_SetBand, 3, 1);
	}

	return FALSE;
}

static uint8 tda778x_cmd_set_stereo(uint8 stereo)
{
	if(stereo)
    {
    	if(!tda778x_cmd_set_mem(PILOT_THS_ADDR, tda778x_ctrl->pilotth))return FALSE;
    }
    else
    {
        if(!tda778x_cmd_set_mem(PILOT_THS_ADDR, 0x7fffff))return FALSE;
		if(!tda778x_cmd_get_mem(PILOT_THS_ADDR, 1))return FALSE;
    }

	return TRUE;
}

static uint8 tda778x_set_mute(uint8 mute)
{
	if(mute == ON)
	{

	}
	else
	{

	}
	return TRUE;
}

static uint8 tda778x_set_stereo(uint8 stereo)
{
	if(stereo == ON)
	{
		if(!tda778x_cmd_set_stereo(ON))return FALSE;
	}
	else
	{
		if(!tda778x_cmd_set_stereo(OFF))return FALSE;
	}

	return TRUE;
}

static uint8 tda778x_cmd_set_dsp_mode(tda778x_dsp_e dsp_mode)
{
	return tda778x_cmd_set_mem(0x01a006, dsp_mode);
}

static uint8 tda778x_set_freq(tda778x_band_e band, uint16 freq)
{
	if(!tda778x_wait_busy())return FALSE;

	switch(band)
	{
		case TDA778x_BAND_FM:
			if(!tda778x_cmd_set_freq(band, freq))return FALSE;
			if(!tda778x_cmd_set_diss(Diss_FM_Manual, Diss_FM_Manual_BW4))return FALSE;
			OSTimeDly(20);
			if(!tda778x_cmd_set_diss(Diss_FM_Auto, 0))return FALSE;
			break;

		case TDA778x_BAND_WB:
			if(!tda778x_cmd_set_freq(band, freq))return FALSE;
			if(!tda778x_cmd_set_diss(Diss_WX_Neutral, 0))return FALSE;
			break;

		case TDA778x_BAND_AM:
			if(!tda778x_cmd_set_freq(band, freq))return FALSE;
			if(!tda778x_cmd_set_diss(Diss_AM_Neutral, 0))return FALSE;
			break;

		case TDA778x_BAND_SW:
			if(!tda778x_cmd_set_freq(band, freq))return FALSE;
			if(!tda778x_cmd_set_diss(Diss_AM_Neutral, 0))return FALSE;
			break;

		default:
			return FALSE;
	}
	return TRUE;
}

static uint8 tda778x_set_init(void)
{
	ew_puts("tda778x_set_init\n");
	if(!tda778x_ctrl->init_succeed)
	{
		tda778x_startup_reset();
		tda778x_hit_download(TDA778x_HIT_BOOT);//
		OSTimeDly(10);
		tda778x_startup_sequence();
		tda778x_cmd_set_dsp_mode(TDA778x_DSP_FM);
		tda778x_cmd_set_FEReg(TDA778x_BAND_FM, 0, 10);
		tda778x_cmd_set_FEReg(TDA778x_BAND_FM, 15, 1);
		tda778x_cmd_set_start_align(AlignVCO);
		OSTimeDly(25);

		if(!tda778x_wait_busy())return FALSE;
		if(!tda778x_cmd_set_dsp_mode(TDA778x_DSP_IDLE))return FALSE;
		if(!tda778x_cmd_init_stereo())return FALSE;
	}

	ew_puts("tda778x_set_init_ok\n");
    return TRUE;
}

static tda778x_band_e tda778x_get_band(void)
{
	switch(tda778x_ctrl->TunerBand)
	{
		case TDA778x_TUNER_BAND_REC_FM:
			return TDA778x_BAND_FM;

		case TDA778x_TUNER_BAND_REC_MW:
			return TDA778x_BAND_AM;

		case TDA778x_TUNER_BAND_REC_SW:
			return TDA778x_BAND_SW;

		case TDA778x_TUNER_BAND_REC_BW:
			return TDA778x_BAND_WB;

		default:
			return TDA778x_BAND_MAX;
	}
}

static uint8 tda778x_change_band(tda778x_band_e band, uint16 min_freq, uint16 max_freq)
{
	ew_printf("tda778x_change_band:%d,%d,%d\n",band,min_freq,max_freq);

	if(band == TDA778x_BAND_FM)
	{
		ew_printf("%s---TDA778x_BAND_FM\n",__FUNCTION__);
		if(!tda778x_cmd_set_dsp_mode(TDA778x_DSP_FM))return FALSE;
		if(!tda778x_hit_download(TDA778x_HIT_FM_WSP))return FALSE;
		if(!tda778x_cmd_set_band(band, min_freq, max_freq))return FALSE;
		if(!tda778x_cmd_set_FEReg(band, 0, 10))return FALSE;
		if(!tda778x_cmd_set_FEReg(band, 15, 1))return FALSE;
		if(!tda778x_cmd_set_DDC())return FALSE;
		OSTimeDly(5);

		if(!tda778x_cmd_set_IR_type(OnlineIR_FM))return FALSE;
		if(!tda778x_cmd_set_MuSICA(1))return FALSE;
		if(!tda778x_set_loc(band, OFF))return FALSE;

    #if defined(_ENABLE_RADIO_RDS_)
     	if(!tda778x_cmd_set_mem(0x014003, 0x0C0C1300))return FALSE;//RDS enable
     	if(!tda778x_cmd_set_mem(0x00f80a, 0x00000000))return FALSE;//Reset RDS decoder
    #endif
	}
	else if(band == TDA778x_BAND_WB)
	{
		if(!tda778x_cmd_set_dsp_mode(TDA778x_DSP_WB))return FALSE;
		if(!tda778x_hit_download(TDA778x_HIT_WX_WSP))return FALSE;
		if(!tda778x_cmd_set_band(band, min_freq, max_freq))return FALSE;
		if(!tda778x_cmd_set_FEReg(band, 0, 10))return FALSE;
		if(!tda778x_cmd_set_FEReg(band, 15, 1))return FALSE;
		if(!tda778x_cmd_set_DDC())return FALSE;
		OSTimeDly(5);

		if(!tda778x_cmd_set_IR_type(HybridIR_FM))return FALSE;
		if(!tda778x_set_loc(band, OFF))return FALSE;

    #if defined(_ENABLE_RADIO_RDS_)
    	if(!tda778x_cmd_set_mem(0x014003,0x0C0C0300))return FALSE;//RDS disable
    #endif
	}
	else if((band == TDA778x_BAND_AM)||(band == TDA778x_BAND_SW))
	{
		if((tda778x_ctrl->area == TDA778x_AREA_EUROPE)||(tda778x_ctrl->area == TDA778x_AREA_JAPAN))
		{
			if(!tda778x_cmd_set_dsp_mode(TDA778x_DSP_AM_EuJp))return FALSE;
		}
		else
		{
			if(!tda778x_cmd_set_dsp_mode(TDA778x_DSP_AM_Us))return FALSE;
		}
		if(!tda778x_hit_download(TDA778x_HIT_AM_WSP))return FALSE;
		if(!tda778x_cmd_set_band(band, min_freq, max_freq))return FALSE;
		if(!tda778x_cmd_set_FEReg(band, 0, 10))return FALSE;
		if(!tda778x_cmd_set_FEReg(band, 15, 1))return FALSE;
		if(!tda778x_cmd_set_DDC())return FALSE;
		OSTimeDly(5);

		if(!tda778x_cmd_set_IR_type(HybridIR_AM))return FALSE;
		if(!tda778x_wait_busy())return FALSE;
		if(!tda778x_set_loc(band, OFF))return FALSE;
	}
	else return FALSE;

	ew_puts("tda778x_change_band_ok\n");
	return TRUE;
}

static uint8 tda778x_cmd_get_seekstatus(tda778x_band_e band,uint32 *get_freq,uint8 *get_station,uint16 *get_signal)
{
	uint16 smeter = 0;
	uint16 detuning = 0;
	uint16 multipath = 0;
	uint16 adj_channe = 0;

	if(band == TDA778x_BAND_FM)
	{
		uint16 total = 10;
		uint16 i;
		uint16 acp;

		for(i = 0; i < total; i++)
		{
			tda778x_write_addr[0] = 0x00;
			tda778x_write_addr[1] = 0x00;
			if(i == (total - 1))
			{
				tda778x_write_addr[2] = SeekStatus_RstQaul;
			}
			else
			{
				tda778x_write_addr[2] = SeekStatus_NoRstQaul;
			}
			if(!tda778x_cmd_write_read(CmdCode_ReadSeekStatus, 1, 1+2+2+1))return FALSE;

			smeter		+= tda778x_read_addr[12];
			detuning	+= tda778x_read_addr[14];
			multipath	+= tda778x_read_addr[9];
			adj_channe 	+= tda778x_read_addr[10];
		}

		smeter		/= total;
		multipath	/= total;
		adj_channe 	/= total;
		detuning	/= total;
		*get_freq 	= _u8tou32_(0x00, tda778x_read_addr[6], tda778x_read_addr[7], tda778x_read_addr[8]);
		*get_freq 	/= 10;

		if(smeter < FSscalingthrmin)
		{
			acp = adj_channe;
		}
		else if(smeter > FSscalingthrmax)
		{
			acp = 0;
		}
		else
		{
			acp = (adj_channe/2) * (FSscalingthrmax - smeter) / (FSscalingthrmax - FSscalingthrmin) + adj_channe/2;
		}

		*get_signal = smeter;

		ew_printf("get_freq == %d\n",(*get_freq));
		ew_printf("smeter == %d--->acp:%d,multipath ==%d,detuning==%d\n",smeter,acp,multipath,detuning);

	#if defined(_ENABLE_RADIO_SEEK_)
		/*if(global.ams_flag)
		{
			if((smeter >= 200) && (acp <= 45) && (multipath <= 25) && (detuning <= 10))
			{
				if((*get_freq) == 9600)
				{
					if(smeter > 230)
					{
						*get_station = 1;
					}
					else
					{
						*get_station = 0;
					}
				}
				else
				{
					*get_station = 1;
				}
			}
			else
			{
				//if(((smeter >= 200) && (acp <= 115) && (acp >= 95)&& (multipath <= 25) && (detuning <= 9*total))
				if((smeter >= 210) && (acp <= 60) && (multipath <= 25) && (detuning <= 10))
				{
					if((smeter >= 230) && (acp > 45))
					{
						*get_station = 0;
					}
					else
					{
						*get_station = 1;
					}
				}
				else
				{
					*get_station = 0;
				}
			}

		}
		else*/
		{
			if((smeter > TDA778x_TUNER_RSSI_FM) && (acp <= 45) && (multipath <= 35) && (detuning <= 10))
			{
				//if((smeter != 216)&&(smeter != 217))//&&(smeter != 218))
				{
					if((*get_freq) == 9600)
					{
						if(smeter > 240)
						{
							*get_station = 1;
						}
						else
						{
							*get_station = 0;
						}
					}
					else if((*get_freq) == 8830)
					{
						if(smeter > 194)
						{
							*get_station = 1;
						}
						else
						{
							*get_station = 0;
						}
					}
					else if((*get_freq) == 10800)
					{
						if(smeter > 191)
						{
							*get_station = 1;
						}
						else
						{
							*get_station = 0;
						}
					}
					else
					{
						*get_station = 1;
					}
				}
			}
			else
			{
				puts("----666----\n");
				//if((smeter >= 190) && (acp <= 60) && (multipath <= 25) && (detuning <= 10))
				if((smeter >= 210) && (acp <= 60) && (multipath <= 35) && (detuning <= 10))
				{
					if((*get_freq) == 9600)
					{
						if(smeter > 240)
						{
							*get_station = 1;
						}
						else
						{
							*get_station = 0;
						}
					}
					else
					{
						if((smeter >= 205) && (acp > 45))
						{
							*get_station = 0;
						}
						else
						{
							*get_station = 1;
						}
					}
				}
				else
				{
					*get_station = 0;
				}
			}
		}

	#else

		if((smeter >= TDA778x_TUNER_FM_TUNE_RSSI) && (acp <= 45) && (multipath <= 25) && (detuning <= 10))
		{
			*get_station = 1;
		}
		else
		{
			//if(((smeter >= 200) && (acp <= 115) && (acp >= 95)&& (multipath <= 25) && (detuning <= 9*total))
			if((smeter >= 190) && (acp <= 60) && (multipath <= 25) && (detuning <= 10))
			{
				if((smeter >= 210) && (acp > 45))
				{
					*get_station = 0;
				}
				else
				{
					*get_station = 1;
				}
			}
			else
			{
				*get_station = 0;
			}
		}
	#endif
		return TRUE;
	}
	else if(band == TDA778x_BAND_AM)
	{
		tda778x_write_addr[0] = 0x00;
		tda778x_write_addr[1] = 0x00;
		tda778x_write_addr[2] = SeekStatus_RstQaul;
		OSTimeDly(5);
		if(!tda778x_cmd_write_read(CmdCode_ReadSeekStatus, 1, 1+2+2+1))return FALSE;

		smeter		= tda778x_read_addr[12];
		detuning	= tda778x_read_addr[14];
		multipath	= tda778x_read_addr[9];
		adj_channe 	= tda778x_read_addr[10];
		*get_freq 	= _u8tou32_(0x00, tda778x_read_addr[6], tda778x_read_addr[7], tda778x_read_addr[8]);

		*get_signal = smeter;
		if((detuning < 16) && (smeter > TDA778x_TUNER_AM_TUNE_RSSI))	//180
		{
			*get_station = 1;
		}
		else
		{
			*get_station = 0;
		}
		return TRUE;
	}
	else return FALSE;
}

static uint8 tda778x_cmd_set_manual_seek(int FreqIncrement)
{
	tda778x_write_addr[0] = _u32to8hl_(FreqIncrement);
	tda778x_write_addr[1] = _u32to8lh_(FreqIncrement);
	tda778x_write_addr[2] = _u32to8ll_(FreqIncrement);

	return tda778x_cmd_write_read(CmdCode_StartManuSeek, 1, 1);
}

static uint8 tda778x_cmd_set_seekend(uint8 SeekEndAction)
{
	tda778x_write_addr[0] = 0x00;
	tda778x_write_addr[1] = 0x00;
	tda778x_write_addr[2] = SeekEndAction & 0x03;//Seek action code: 01-Continue, 10-StopMuted, 11-StopUnmuted

	return tda778x_cmd_write_read(CmdCode_SeekEnd, 1, 1);
}

static uint8 tda778x_seek_on(tda778x_band_e band, int step)
{
	ew_printf("%s--->step:%d\n",__FUNCTION__,step);
	switch(band)
	{
		case TDA778x_BAND_FM:
			if(!tda778x_cmd_set_manual_seek(step * 10))return FALSE;
			break;

		case TDA778x_BAND_AM:
			if(!tda778x_cmd_set_manual_seek(step))return FALSE;
			break;

		case TDA778x_BAND_WB:
			if(!tda778x_cmd_set_manual_seek(step))return FALSE;
			break;

		case TDA778x_BAND_SW:
			if(!tda778x_cmd_set_manual_seek(step * 5))return FALSE;
			break;

		default:
			return FALSE;
	}
	tda778x_ctrl->TunerAutoSeek = TRUE;
	return TRUE;
}

/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
#if defined(_ENABLE_RADIO_RDS_)
static void tda778x_rds_reset(void)
{
	if(tda778x_ctrl->tuner_rds.enable)
	{
		rds_dec_reset();
		tda778x_ctrl->tuner_rds.discard = 1;
		tda778x_ctrl->tuner_rds.quality = 0;

		tda778x_ctrl->tuner_rds.block_cnt = 1;
		tda778x_ctrl->tuner_rds.get_block = 0;
	}
}

//uint8 rds_flag = 0;
static void tda778x_rds_decode(void)
{
	uint8 dok,syn,z,cp;
	//uint16 rds[2000];

	/*if(rds_flag)
	{
		rds[0] = 1;
		ew_printf("rds[0]:%d\n",rds[0]);
	}*/

	if(!tda778x_ctrl->tuner_rds.enable)return;

	if(tda778x_ctrl->tuner_rds.quality >= tda778x_ctrl->tuner_rds.factor)
	{
		tda778x_ctrl->tuner_rds.quality -= tda778x_ctrl->tuner_rds.factor;
	}
	rds_dec_timer();

	if(!tda778x_cmd_get_mem(0x00f800, 1))return;

	syn =  tda778x_read_addr[3]&0x01;
	dok = (tda778x_read_addr[3]&0x02)>>1;
	z 	= (tda778x_read_addr[4]&0x80)>>7;
	cp 	= (tda778x_read_addr[3]&0xF8)>>3;
	//ew_printf("b:%02X",tda778x_read_addr[4]&0x30);

	switch(tda778x_ctrl->tuner_rds.block_cnt)
	{
		case 1:
			if((tda778x_read_addr[4]&0x30)==0x0)//A
			{
				//ew_printf("tda778x_rds_decode A  %d %d  %d %d\n",cp,syn,dok,z);
				if((!cp) && syn && dok && z)
				{
				    //ew_printf("A");//
					tda778x_ctrl->tuner_rds.get_block |= 0x01;
					tda778x_ctrl->tuner_rds.block_a = _u8tou16_(tda778x_read_addr[5],tda778x_read_addr[8]);
					tda778x_ctrl->tuner_rds.block_cnt = 2;

					tda778x_ctrl->tuner_rds.quality = 0xFF;
					rds_block_a_dec(_u16to8h_(tda778x_ctrl->tuner_rds.block_a), _u16to8l_(tda778x_ctrl->tuner_rds.block_a));
				}
				else
				{
					tda778x_ctrl->tuner_rds.get_block &= 0xFE;
					//ew_printf("E1");//
				}
			}
			else
			{
				//ew_printf("E2");//
			}
			break;

		case 2:
			if((tda778x_read_addr[4]&0x30)==0x10)//B
			{
			//ew_printf("tda778x_rds_decode B  %d %d  %d %d\n",cp,syn,dok,z);
				if((!cp) && syn && dok && z)
				{
				    //ew_printf("B");//
					tda778x_ctrl->tuner_rds.get_block |= 0x02;
					tda778x_ctrl->tuner_rds.block_b = _u8tou16_(tda778x_read_addr[5],tda778x_read_addr[8]);
					tda778x_ctrl->tuner_rds.block_cnt = 3;

					tda778x_ctrl->tuner_rds.quality = 0xFF;
					rds_block_b_dec(_u16to8h_(tda778x_ctrl->tuner_rds.block_b), _u16to8l_(tda778x_ctrl->tuner_rds.block_b));
				}
				else
				{
					tda778x_ctrl->tuner_rds.get_block &= 0xFC;
					//ew_printf("E3");//
				}
			}
			else
			{
				//ew_printf("E4");//
			}
			break;

		case 3:
			if((tda778x_read_addr[4]&0x30)==0x20)//C
			{
			//ew_printf("tda778x_rds_decode c  %d %d  %d %d\n",cp,syn,dok,z);
				if((!cp) && syn && dok && z)
				{
				    //ew_printf("C");//
					tda778x_ctrl->tuner_rds.get_block |= 0x04;
					tda778x_ctrl->tuner_rds.block_c = _u8tou16_(tda778x_read_addr[5],tda778x_read_addr[8]);
					tda778x_ctrl->tuner_rds.block_cnt = 4;

					tda778x_ctrl->tuner_rds.quality = 0xFF;
					rds_block_c_dec(_u16to8h_(tda778x_ctrl->tuner_rds.block_c), _u16to8l_(tda778x_ctrl->tuner_rds.block_c));
				}
				else
				{
					tda778x_ctrl->tuner_rds.get_block &= 0xF8;
					//ew_printf("E5");//
				}
			}
			else
			{
				//ew_printf("E6");//
			}
			break;

		case 4:
			if((tda778x_read_addr[4]&0x30)==0x30)//D
			{
			//ew_printf("tda778x_rds_decode D  %d %d  %d %d\n",cp,syn,dok,z);
				if((!cp) && syn && dok && z)
				{
				    //ew_printf("D");//
					tda778x_ctrl->tuner_rds.get_block |= 0x08;
					tda778x_ctrl->tuner_rds.block_d = _u8tou16_(tda778x_read_addr[5],tda778x_read_addr[8]);
					tda778x_ctrl->tuner_rds.block_cnt = 1;

					if((tda778x_ctrl->tuner_rds.get_block & 0x0F) == 0x0F)
					{
						tda778x_ctrl->tuner_rds.get_block = 0;

						rds_input_t input;

						input.block_ah = _u16to8h_(tda778x_ctrl->tuner_rds.block_a);
						input.block_al = _u16to8l_(tda778x_ctrl->tuner_rds.block_a);
						input.block_bh = _u16to8h_(tda778x_ctrl->tuner_rds.block_b);
						input.block_bl = _u16to8l_(tda778x_ctrl->tuner_rds.block_b);
						input.block_ch = _u16to8h_(tda778x_ctrl->tuner_rds.block_c);
						input.block_cl = _u16to8l_(tda778x_ctrl->tuner_rds.block_c);
						input.block_dh = _u16to8h_(tda778x_ctrl->tuner_rds.block_d);
						input.block_dl = _u16to8l_(tda778x_ctrl->tuner_rds.block_d);

						//ew_printf("%02X%02X%02X%02X",input.block_ah,input.block_al,input.block_bh,input.block_bl);
						//ew_printf("%02X%02X%02X%02X",input.block_ch,input.block_cl,input.block_dh,input.block_dl);

						tda778x_ctrl->tuner_rds.quality = 0xFF;

						rds_stream_dec(&input);
					}
					else if(tda778x_ctrl->tuner_rds.get_block & 0x08)
					{
						tda778x_ctrl->tuner_rds.quality = 0xFF;
						rds_block_d_dec(_u16to8h_(tda778x_ctrl->tuner_rds.block_d), _u16to8l_(tda778x_ctrl->tuner_rds.block_d));
						//ew_printf("E7");//
					}
				}
				else
				{
					tda778x_ctrl->tuner_rds.get_block &= 0xF0;
					//ew_printf("E8");//
				}
			}
			else
			{
				//ew_printf("E9");//
			}
			break;
	}
}
#endif

static uint8 tda778x_reset_autoseek(void)
{
	if(tda778x_ctrl->TunerAutoSeek)
	{
	#if 0//defined(_ENABLE_RADIO_RDS_)
		if(tda778x_ctrl.tuner_rds.enable && tda778x_ctrl.tuner_rds.check_wait)
		{
			tda778x_ctrl.tuner_rds.check_wait = 0;
		}
		else
	#endif
		{
			//if(tda778x_ctrl->tune_mode)
			{
				if(!tda778x_cmd_set_seekend(SeekStopUnmuted))return FALSE;
				//tda778x_ctrl->tune_mode = FALSE;
				OSTimeDly(10);
			}
		}
		tda778x_ctrl->TunerAutoSeek = FALSE;
	}

	return TRUE;
}
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------*/

static uint8 tuner_tda778x_detect(void);
static uint8 tuner_tda778x_init(radio_band_e, uint16, uint16, uint16);
static uint8 tuner_tda778x_exit(void);
static uint8 tuner_tda778x_freq(uint16);
static uint8 tuner_tda778x_status(engine_status_t *);
static uint8 tuner_tda778x_search(uint16, engine_status_t *);
static uint8 tuner_tda778x_hard(engine_hard_t *hard);
static uint8 tuner_tda778x_setting(fm_setting_e, void *);
static uint8 tuner_tda778x_info(fm_info_e, void *);


static uint8 tuner_tda778x_detect(void)
{
#if defined(_TUNER_DRIVER_TDA770x_)
	return FALSE;
#else
	uint8 r = check_detect_tda778x();

	//ew_printf("%s, r:%d\n", __FUNCTION__, r);
	return r;
#endif
}

static uint8 tuner_tda778x_init(radio_band_e band, uint16 min_freq, uint16 max_freq, uint16 freq)
{
	ew_printf("%s, band:%d, min_freq:%d, max_freq:%d, freq:%d\n", __FUNCTION__, band, min_freq, max_freq, freq);

	if(tda778x_ctrl == NULL)
	{
		tda778x_ctrl = (tda778x_ctrl_t *)malloc_fun(tda778x_ctrl, sizeof(tda778x_ctrl_t), 0);
		if(tda778x_ctrl == NULL)
		{
			return FALSE;
		}
		tda778x_ctrl->area = TDA778x_AREA_EUROPE;
	}

	ew_puts("tda778x_memory_ok\n");

	switch(band)
	{
		case RADIO_BAND_FM:
			if(min_freq > max_freq)goto tda778x_init_error;
			if(min_freq < 6400)goto tda778x_init_error;
			if(max_freq > 10800)goto tda778x_init_error;
			tda778x_ctrl->TunerBand = TDA778x_TUNER_BAND_REC_FM;
			break;

		case RADIO_BAND_AM:
	    #if defined(_SEEK_REFRESH_FREQ_)
	    	global.pty_flag = 0;
	    #endif
			if(min_freq > max_freq)goto tda778x_init_error;
			if(min_freq < 520)goto tda778x_init_error;
			if(max_freq > 1710)goto tda778x_init_error;
			tda778x_ctrl->TunerBand = TDA778x_TUNER_BAND_REC_MW;
			break;

		default:
			goto tda778x_init_error;
			break;
	}

	if(tda778x_ctrl->band == band)
	{
		if(tda778x_ctrl->init_succeed)
		{
			if(tda778x_ctrl->now_freq == freq)
			{
				tda778x_ctrl->min_freq = min_freq;
				tda778x_ctrl->max_freq = max_freq;
				if(!tuner_tda778x_setting(TUR_SET_MUTE, OFF))goto tda778x_init_error;
				return TRUE;
			}
			else
			{
				goto tda778x_init_freq;
			}
		}
		else
		{
			goto tda778x_init_error;
		}
	}

	if(!tda778x_set_init())goto tda778x_init_error;

tda778x_init_freq:
	ew_puts("tda778x_init_freq\n");
	if(!tda778x_change_band(tda778x_get_band(), min_freq, max_freq))return FALSE;
	tda778x_ctrl->band = band;
	tda778x_ctrl->min_freq = min_freq;
	tda778x_ctrl->max_freq = max_freq;
	tda778x_ctrl->init_succeed = TRUE;

	engine_status_t status;
	if(!tuner_tda778x_search(freq, &status))goto tda778x_init_error;
	OSTimeDly(10);
	if(!tuner_tda778x_search(freq, &status))goto tda778x_init_error;
	//OSTimeDly(10);
	//if(!tuner_tda778x_search(freq, &status))goto tda778x_init_error;
	if(!tuner_tda778x_setting(TUR_SET_MUTE, OFF))goto tda778x_init_error;
	ew_puts("TDA778x Init Succeed!!!!!\n");
	return TRUE;

tda778x_init_error:
	free_fun((void **)&tda778x_ctrl);
	ew_puts("TDA778x Init Fail!!!!!\n");
	return FALSE;
}

static uint8 tuner_tda778x_exit(void)
{
	ew_puts("tuner_tda778x_exit\n");
	if(tda778x_ctrl)
	{
		free_fun((void **)&tda778x_ctrl);
	}

	return TRUE;
}

static uint8 tuner_tda778x_freq(uint16 freq)
{
	if(tda778x_ctrl == NULL)return FALSE;
	if(!tda778x_ctrl->init_succeed)return FALSE;
	if(freq < tda778x_ctrl->min_freq)return FALSE;
	if(freq > tda778x_ctrl->max_freq)return FALSE;

	ew_printf("%s, freq:%d\n", __FUNCTION__, freq);

	if(!tda778x_set_freq(tda778x_get_band(), freq))return FALSE;

#if defined(_ENABLE_RADIO_RDS_)
	tda778x_rds_reset();
#endif

	tda778x_ctrl->now_freq = freq;
	tda778x_ctrl->signal = 0;
	tda778x_ctrl->last_sys_timer = g_rand_seed;
	return TRUE;
}

static uint8 tuner_tda778x_status(engine_status_t *status)
{
	if(tda778x_ctrl == NULL)return FALSE;
	if(!tda778x_ctrl->init_succeed)return FALSE;

	uint8 fm_mode 	= (tda778x_ctrl->TunerBand == TDA778x_TUNER_BAND_REC_FM) ? 1 : 0;
	status->band 	= fm_mode ? RADIO_BAND_FM : RADIO_BAND_AM;
	status->freq 	= tda778x_ctrl->now_freq;
	status->signal 	= tda778x_ctrl->signal;
	status->stc 	= FALSE;
	status->valid   = FALSE;
	status->stereo 	= FALSE;

	if(tda778x_ctrl->TunerAutoSeek)
	{
		ew_puts("tuner_tda778x_status\n");
		uint8  station = 0;
		uint16 signal = 0;
		uint32 get_freq = 0;

	#if !defined(_ENABLE_RADIO_SEEK_)
		OSTimeDly(1);
	#endif
	#if defined(_ENABLE_TDA778x_SEEK_)
		OSTimeDly(3);
	#endif
	
		if(tda778x_cmd_get_seekstatus(tda778x_get_band(), &get_freq, &station, &signal))
		{
			ew_puts("tuner_tda778x_status111\n");
		#if defined(_ENABLE_RADIO_SEEK_)
			if(!station)
			{
				ew_puts("tuner_tda778x_status222\n");
				OSTimeDly(1);
				tda778x_cmd_get_seekstatus(tda778x_get_band(), &get_freq, &station, &signal);
			}
		#else
    		OSTimeDly(1);
    		tda778x_cmd_get_seekstatus(tda778x_get_band(), &get_freq, &station, &signal);
		#endif
		
			tda778x_ctrl->now_freq	= get_freq;
			tda778x_ctrl->station	= station;
			tda778x_ctrl->signal	= signal;

			status->stc = TRUE;
			if(tda778x_ctrl->station)
			{
				if(!tda778x_cmd_set_seekend(SeekStopUnmuted))return FALSE;
				status->stc = TRUE;
			}
			else
			{
				if(tda778x_cmd_set_seekend(SeekContinue))
				{
					tda778x_ctrl->station = FALSE;
					status->stc = FALSE;
				}
			}
			status->valid = tda778x_ctrl->station;
			status->freq  = tda778x_ctrl->now_freq;
			status->signal= tda778x_ctrl->signal;
			printf("status->valid:%d\n",status->valid);
		}
	}
	else
	{
		//ew_puts("tuner_tda778x_status222\n");
		OSTimeDly(2);
		if(!tda778x_cmd_get_smeter(tda778x_get_band(), &tda778x_ctrl->signal, &tda778x_ctrl->detun, &tda778x_ctrl->dummy))return FALSE;
		status->signal	= tda778x_ctrl->signal;
		status->stc = TRUE;

    #if defined(_SPECIAL_AUTOSEEK_MEMORY_)
    	setup.rssi = status->signal;
    	//ew_printf("setup.rssi:%d\n",setup.rssi);
    #endif

		//ew_printf("status->signal:%d\n",status->signal);
    	//ew_printf("tda778x_ctrl->dummy:%d\n",tda778x_ctrl->dummy);
    	//ew_printf("tda778x_ctrl->detun:%d\n",tda778x_ctrl->detun);
		if(fm_mode)
		{
			if((status->signal >= TDA778x_TUNER_FM_TUNE_RSSI)
				&&((tda778x_ctrl->dummy < 3)
				||(tda778x_ctrl->detun > 90))
				&&(tda778x_ctrl->now_freq != 10800))
			{
				status->valid = TRUE;
			}

		#if defined(_ENABLE_STO_ICON_)
    		if((status->signal >= 175)
    			&&((tda778x_ctrl->dummy < 3)
    			||(tda778x_ctrl->detun > 90)))
    		{
    			if(!setup.mono_flg)
    			{
    				status->stereo = TRUE;
    			}
    		}
		#endif

			if(status->signal > TDA778x_TUNER_ST_RSSI)
			{
			#if !defined(_ENABLE_STO_ICON_)
				uint8 stereo = FALSE;
				if(!tda778x_cmd_get_stereo(&stereo))return FALSE;
				if(stereo)
				{
					status->stereo = TRUE;
				}
			#endif
			}
		}
		else
		{
			if((status->signal>TDA778x_TUNER_AM_TUNE_RSSI)
			&&(tda778x_ctrl->detun>70)&&(tda778x_ctrl->dummy<5))
			{
				status->valid = TRUE;
			}
		}
	}

	return TRUE;
}

static uint8 tuner_tda778x_search(uint16 freq, engine_status_t *status)
{
	ew_printf("%s, freq:%d\n", __FUNCTION__, freq);

	if(tda778x_ctrl == NULL)return FALSE;
	if(!tda778x_ctrl->init_succeed)return FALSE;
	if(freq < tda778x_ctrl->min_freq)return FALSE;
	if(freq > tda778x_ctrl->max_freq)return FALSE;

	if(!tuner_tda778x_freq(freq))return FALSE;
	OSTimeDly(5);

	uint8 time_over = 40;
	do{
		OSTimeDly(1);
		if(!tuner_tda778x_status(status))return FALSE;
	}while(!status->stc && (--time_over));

	return TRUE;
}

static uint8 tuner_tda778x_hard(engine_hard_t *hard)
{
	if(tda778x_ctrl == NULL)return FALSE;
	if(!tda778x_ctrl->init_succeed)return FALSE;
	ew_printf("%s--->run---hard->enable:%d\n", __FUNCTION__,hard->enable);
	if(hard->enable)
	{
		engine_hard_start_t *start = &hard->ctrl.start;

		if(start->min_freq < tda778x_ctrl->min_freq)return FALSE;
		if(start->max_freq > tda778x_ctrl->max_freq)return FALSE;
		if(start->start_freq < start->min_freq)return FALSE;
		if(start->start_freq > start->max_freq)return FALSE;

		if(!tda778x_reset_autoseek())return FALSE;

		if(start->start_freq != tda778x_ctrl->now_freq)
		{
			if(!tda778x_set_freq(tda778x_get_band(),start->start_freq))return FALSE;
		}

		if(!tda778x_seek_on(tda778x_get_band(), (hard->ctrl.start.dir == UP)?
			((int)hard->ctrl.start.step):-((int) hard->ctrl.start.step))) return FALSE;

		OSTimeDly(20);

	#if defined(_ENABLE_RADIO_RDS_)
		tda778x_rds_reset();
	#endif
	}
	else
	{
		engine_hard_stop_t *stop = &hard->ctrl.stop;
		ew_printf("%s--->stop->stop_freq:%d\n", __FUNCTION__,stop->stop_freq);
		if(stop->stop_freq == 0xFFFF)
		{
			if(!tda778x_reset_autoseek())return FALSE;
		}
		else
		{
			if(stop->stop_freq < tda778x_ctrl->min_freq)return FALSE;
			if(stop->stop_freq > tda778x_ctrl->max_freq)return FALSE;
			if(!tda778x_reset_autoseek())return FALSE;
		}
		ew_puts("tuner_tda778x_hard--->stop succeed\n");
	}
	return TRUE;
}


static uint8 tuner_tda778x_setting(fm_setting_e type, void *set)
{
	if(tda778x_ctrl == NULL)return FALSE;
	if(!tda778x_ctrl->init_succeed)return FALSE;

	switch(type)
	{
		case TUR_SET_MUTE:
			{
				uint8 mute = (uint8)set;
				if(!tda778x_set_mute(mute))return FALSE;
			}
			break;

		case TUR_SET_STEREO:
			{
				uint8 stereo = (uint8)set;
				if(tda778x_ctrl->TunerBand == TDA778x_TUNER_BAND_REC_FM)
				{
					if(!tda778x_set_stereo(stereo))return FALSE;
				}
				else return FALSE;
			}
			break;

	#if defined(_ENABLE_RADIO_RDS_)
		case TUR_SET_RDS:
			{
				typedef struct{
					uint8 enable;
					uint16 timer;
					uint8 result;
				}tuner_rds_ctrl_t;
				tuner_rds_ctrl_t *rds_ctrl = ((tuner_rds_ctrl_t *)set);

				if(rds_ctrl->enable)
				{
					if(tda778x_ctrl->TunerBand == TDA778x_TUNER_BAND_REC_FM)
					{
						if((tda778x_ctrl->min_freq >= 8750) && (tda778x_ctrl->max_freq <= 10800))
						{
							if(!tda778x_ctrl->tuner_rds.enable)
							{
								int check = FALSE;
								if(!tuner_tda778x_info(TUR_INFO_RDS, &check))return FALSE;
								if(check)
								{
									tda778x_ctrl->tuner_rds.factor = 255/(_RDS_QUALITY_TIME_/rds_ctrl->timer);
									tda778x_ctrl->tuner_rds.enable = TRUE;
									tda778x_rds_reset();
									rds_dec_det_time(rds_ctrl->timer);
									rds_ctrl->result = TRUE;
								}
							}
						}
						else return FALSE;
					}
					else return FALSE;
				}
				else
				{
					if(tda778x_ctrl->tuner_rds.enable)
					{
						tda778x_ctrl->tuner_rds.enable = FALSE;
						rds_ctrl->result = TRUE;
					}
					else return FALSE;
				}
			}
			break;

		case TUR_SET_RDS_RESET:
			{
				if(tda778x_ctrl->tuner_rds.enable)
				{
					tda778x_rds_reset();
				}
				else return FALSE;
			}
			break;

		case TUR_SET_RDS_DECODE:
			{
		    #if defined(_SEEK_REFRESH_FREQ_)
		    	if((tda778x_ctrl->tuner_rds.enable)&&(setup.rds.af || setup.rds.ta || global.pty_flag))
		    #else
		    	if(tda778x_ctrl->tuner_rds.enable)
		    #endif
				{
					tda778x_rds_decode();
				}
				else return FALSE;
			}
			break;

		case TUR_SET_RDS_EON:
			{
				if(tda778x_ctrl->tuner_rds.enable)
				{
					uint8 disable = (uint8)set;
					rds_dec_eon(disable);
				}
				else return FALSE;
			}
			break;

		case TUR_SET_RDS_SAVE:
			if(set != NULL)
			{
				if(tda778x_ctrl->tuner_rds.enable)
				{
					radio_rds_station_t *write_station = (radio_rds_station_t *)set;
					rds_dec_save(write_station);
				}
				else return FALSE;
			}
			else return FALSE;
			break;
	#endif

		default:
			return FALSE;
	}
	return TRUE;
}

static uint8 tuner_tda778x_info(fm_info_e type, void *info)
{
	switch(type)
	{
		case TUR_INFO_DRV:
			if(info != NULL)
			{
				*(uint8 *)info = TUN_DRV_TDA778x;
			}
			break;

		case TUR_INFO_FM_RSSI:
			if(info != NULL)
			{
				*(uint8 *)info = TDA778x_TUNER_RSSI_FM;
			}
			break;

		case TUR_INFO_FM_LOC_RSSI:
			if(info != NULL)
			{
				*(uint8 *)info = TDA778x_TUNER_FM_LOC_TUNE_RSSI;
			}
			break;

		case TUR_INFO_FM_DEAD_SPOT_LENGTH:
			if(info != NULL)
			{
				*(uint8 *)info = sizeof(fm_tda778x_deal_spot_tab)/sizeof(uint16);
			}
			break;

		case TUR_INFO_FM_DEAD_SPOT_TAB:
			if(info != NULL)
			{
				*(int *)info = (int)fm_tda778x_deal_spot_tab;
			}
			break;

		case TUR_INFO_AM_RSSI:
			if(info != NULL)
			{
				*(uint8 *)info = TDA778x_TUNER_RSSI_AM;
			}
			break;

		case TUR_INFO_AM_LOC_RSSI:
			if(info != NULL)
			{
				*(uint8 *)info = TDA778x_TUNER_RSSI_LOC_AM;
			}
			break;

		case TUR_INFO_AM_DEAD_SPOT_LENGTH:
			if(info != NULL)
			{
				*(uint8 *)info = sizeof(am_tda778x_deal_spot_tab)/sizeof(uint16);
			}
			break;

		case TUR_INFO_AM_DEAD_SPOT_TAB:
			if(info != NULL)
			{
				*(int *)info = (int)am_tda778x_deal_spot_tab;
			}
			break;

		case TUR_INFO_AUTOSEEK:
			if(info != NULL)
			{
				*(uint8 *)info = ENABLE;	//DISABLE
			}
			break;

	#if defined(_ENABLE_RADIO_RDS_)
		case TUR_INFO_RDS:
			if(info != NULL)
			{
				*(uint8 *)info = TRUE;
			}
			break;

		case TUR_INFO_RDS_INFO:
			if(info != NULL)
			{
				if(tda778x_ctrl == NULL)return FALSE;
				if(!tda778x_ctrl->init_succeed)return FALSE;
				if(!tda778x_ctrl->tuner_rds.enable)return FALSE;

				radio_rds_info_t *rds_info = (radio_rds_info_t *)info;
				rds_dec_info(rds_info);
			}
			break;

		case TUR_INFO_RDS_APP:
			if(info != NULL)
			{
				if(tda778x_ctrl == NULL)return FALSE;
				if(!tda778x_ctrl->init_succeed)return FALSE;
				if(!tda778x_ctrl->tuner_rds.enable)return FALSE;

				radio_rds_app_t *rds_app = (radio_rds_app_t *)info;
				engine_status_t status;
				if(!tuner_tda778x_status(&status))return FALSE;
				rds_app->freq	= status.freq;
				rds_app->level	= status.signal;
				rds_app->stc	= status.stc;
				rds_app->found	= status.valid;
				rds_app->signal = tda778x_ctrl->tuner_rds.quality;
				rds_dec_app(rds_app);
			}
			break;

		case TUR_INFO_RDS_LOAD:
			if(info != NULL)
			{
				if(tda778x_ctrl == NULL)return FALSE;
				if(!tda778x_ctrl->init_succeed)return FALSE;
				if(!tda778x_ctrl->tuner_rds.enable)return FALSE;

				radio_rds_station_t *read_station = (radio_rds_station_t *)info;
				rds_dec_load(read_station);
			}
			break;
	#endif

		default:
			return FALSE;
	}
	return TRUE;
}

const tuner_drv_fun_t tuner_tda778x_drv_fun =
{
	tuner_tda778x_detect,
	tuner_tda778x_init,
	tuner_tda778x_exit,
	tuner_tda778x_freq,
	tuner_tda778x_status,
	tuner_tda778x_search,
	tuner_tda778x_hard,
	tuner_tda778x_setting,
	tuner_tda778x_info,
};

#endif

